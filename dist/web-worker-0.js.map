{"version":3,"file":"index.js","sources":["src/worker/Requests.js","src/worker/index.js"],"sourcesContent":["\r\nconst\t_self = self || window,\r\n\t\tserverBase = _self.serverBase || '//maps.kosmosnimki.ru/',\r\n\t\tserverProxy = serverBase + 'Plugins/ForestReport/proxy';\r\n\r\nlet _app = {},\r\n\tloaderStatus = {},\r\n\t_sessionKeys = {},\r\n\tstr = self.location.origin || '',\r\n\t_protocol = str.substring(0, str.indexOf('/')),\r\n\tsyncParams = {},\r\n\tfetchOptions = {\r\n\t\t// method: 'post',\r\n\t\t// headers: {'Content-type': 'application/x-www-form-urlencoded'},\r\n\t\tmode: 'cors',\r\n\t\tredirect: 'follow',\r\n\t\tcredentials: 'include'\r\n\t};\r\n\r\nconst parseURLParams = (str) => {\r\n\tlet sp = new URLSearchParams(str || location.search),\r\n\t\tout = {},\r\n\t\tarr = [];\r\n\tfor (let p of sp) {\r\n\t\tlet k = p[0], z = p[1];\r\n\t\tif (z) {\r\n\t\t\tif (!out[k]) {out[k] = [];}\r\n\t\t\tout[k].push(z);\r\n\t\t} else {\r\n\t\t\tarr.push(k);\r\n\t\t}\r\n\t}\r\n\treturn {main: arr, keys: out};\r\n};\r\nlet utils = {\r\n\textend: function (dest) {\r\n\t\tvar i, j, len, src;\r\n\r\n\t\tfor (j = 1, len = arguments.length; j < len; j++) {\r\n\t\t\tsrc = arguments[j];\r\n\t\t\tfor (i in src) {\r\n\t\t\t\tdest[i] = src[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dest;\r\n\t},\r\n\r\n\tmakeTileKeys: function(it, ptiles) {\r\n\t\tvar tklen = it.tilesOrder.length,\r\n\t\t\tarr = it.tiles,\r\n\t\t\ttiles = {},\r\n\t\t\tnewTiles = {};\r\n\r\n\t\twhile (arr.length) {\r\n\t\t\tvar t = arr.splice(0, tklen),\r\n\t\t\t\ttk = t.join('_'),\r\n\t\t\t\ttile = ptiles[tk];\r\n\t\t\tif (!tile || !tile.data) {\r\n\t\t\t\tif (!tile) {\r\n\t\t\t\t\ttiles[tk] = {\r\n\t\t\t\t\t\ttp: {z: t[0], x: t[1], y: t[2], v: t[3], s: t[4], d: t[5]}\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttiles[tk] = tile;\r\n\t\t\t\t}\r\n\t\t\t\tnewTiles[tk] = true;\r\n\t\t\t} else {\r\n\t\t\t\ttiles[tk] = tile;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {tiles: tiles, newTiles: newTiles};\r\n\t},\r\n\r\n\tgetDataSource: function(id, hostName) {\r\n\t\t// var maps = gmx._maps[hostName];\r\n\t\t// for (var mID in maps) {\r\n\t\t\t// var ds = maps[mID].dataSources[id];\r\n\t\t\t// if (ds) { return ds; }\r\n\t\t// }\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetZoomRange: function(info) {\r\n\t\tvar arr = info.properties.styles,\r\n\t\t\tout = [40, 0];\r\n\t\tfor (var i = 0, len = arr.length; i < len; i++) {\r\n\t\t\tvar st = arr[i];\r\n\t\t\tout[0] = Math.min(out[0], st.MinZoom);\r\n\t\t\tout[1] = Math.max(out[1], st.MaxZoom);\r\n\t\t}\r\n\t\tout[0] = out[0] === 40 ? 1 : out[0];\r\n\t\tout[1] = out[1] === 0 ? 22 : out[1];\r\n\t\treturn out;\r\n\t},\r\n\r\n\tchkProtocol: function(url) {\r\n\t\treturn url.substr(0, _protocol.length) === _protocol ? url : _protocol + url;\r\n\t},\r\n\tgetFormBody: function(par) {\r\n\t\treturn Object.keys(par).map(function(key) { return encodeURIComponent(key) + '=' + encodeURIComponent(par[key]); }).join('&');\r\n\t},\r\n\tchkResponse: function(resp, type) {\r\n\t\tif (resp.status < 200 || resp.status >= 300) {\t\t\t\t\t\t// error\r\n\t\t\treturn Promise.reject(resp);\r\n\t\t} else {\r\n\t\t\tvar contentType = resp.headers.get('Content-Type');\r\n\t\t\tif (type === 'bitmap') {\t\t\t\t\t\t\t\t\t\t\t\t// get blob\r\n\t\t\t\treturn resp.blob();\r\n\t\t\t} else if (contentType.indexOf('application/json') > -1) {\t\t\t\t// application/json; charset=utf-8\r\n\t\t\t\treturn resp.json();\r\n\t\t\t} else if (contentType.indexOf('text/javascript') > -1) {\t \t\t\t// text/javascript; charset=utf-8\r\n\t\t\t\treturn resp.text();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.text();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.formData();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.arrayBuffer();\r\n\t\t\t// } else {\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn resp.text();\r\n\t},\r\n\t// getJson: function(url, params, options) {\r\n\tgetJson: function(queue) {\r\n// log('getJson', _protocol, queue, Date.now())\r\n\t\tvar par = utils.extend({}, queue.params, syncParams),\r\n\t\t\toptions = queue.options || {},\r\n\t\t\topt = utils.extend({\r\n\t\t\t\tmethod: 'post',\r\n\t\t\t\theaders: {'Content-type': 'application/x-www-form-urlencoded'}\r\n\t\t\t\t// mode: 'cors',\r\n\t\t\t\t// redirect: 'follow',\r\n\t\t\t\t// credentials: 'include'\r\n\t\t\t}, fetchOptions, options, {\r\n\t\t\t\tbody: utils.getFormBody(par)\r\n\t\t\t});\r\n\t\treturn fetch(utils.chkProtocol(queue.url), opt)\r\n\t\t.then(function(res) {\r\n\t\t\treturn utils.chkResponse(res, options.type);\r\n\t\t})\r\n\t\t.then(function(res) {\r\n\t\t\tvar out = {url: queue.url, queue: queue, load: true, res: res};\r\n\t\t\t// if (queue.send) {\r\n\t\t\t\t// handler.workerContext.postMessage(out);\r\n\t\t\t// } else {\r\n\t\t\t\treturn out;\r\n\t\t\t// }\r\n\t\t})\r\n\t\t.catch(function(err) {\r\n\t\t\treturn {url: queue.url, queue: queue, load: false, error: err.toString()};\r\n\t\t\t// handler.workerContext.postMessage(out);\r\n\t\t});\r\n    },\r\n\r\n    getTileAttributes: function(prop) {\r\n        var tileAttributeIndexes = {},\r\n            tileAttributeTypes = {};\r\n        if (prop.attributes) {\r\n            var attrs = prop.attributes,\r\n                attrTypes = prop.attrTypes || null;\r\n            if (prop.identityField) { tileAttributeIndexes[prop.identityField] = 0; }\r\n            for (var a = 0; a < attrs.length; a++) {\r\n                var key = attrs[a];\r\n                tileAttributeIndexes[key] = a + 1;\r\n                tileAttributeTypes[key] = attrTypes ? attrTypes[a] : 'string';\r\n            }\r\n        }\r\n        return {\r\n            tileAttributeTypes: tileAttributeTypes,\r\n            tileAttributeIndexes: tileAttributeIndexes\r\n        };\r\n    }\r\n};\r\n/*\r\nconst requestSessionKey = (serverHost, apiKey) => {\r\n\tlet keys = _sessionKeys;\r\n\tif (!(serverHost in keys)) {\r\n\t\tkeys[serverHost] = new Promise(function(resolve, reject) {\r\n\t\t\tif (apiKey) {\r\n\t\t\t\tutils.getJson({\r\n\t\t\t\t\turl: '//' + serverHost + '/ApiKey.ashx',\r\n\t\t\t\t\tparams: {WrapStyle: 'None', Key: apiKey}\r\n\t\t\t\t})\r\n\t\t\t\t\t.then(function(json) {\r\n\t\t\t\t\t\tlet res = json.res;\r\n\t\t\t\t\t\tif (res.Status === 'ok' && res.Result) {\r\n\t\t\t\t\t\t\tresolve(res.Result.Key !== 'null' ? '' : res.Result.Key);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treject(json);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(function() {\r\n\t\t\t\t\t\tresolve('');\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tresolve('');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn keys[serverHost];\r\n};\r\n*/\r\nconst getMapTree = (params) => {\r\n\tparams = params || {};\r\n\treturn utils.getJson({\r\n\t\turl: serverBase + 'Map/GetMapFolder',\r\n\t\t// options: {},\r\n\t\tparams: {\r\n\t\t\tsrs: 3857, \r\n\t\t\tskipTiles: 'All',\r\n\r\n\t\t\tmapId: (params.mapId || 'C8612B3A77D84F3F87953BEF17026A5F'),\r\n\t\t\tfolderId: 'root',\r\n\t\t\tvisibleItemOnly: false\r\n\t\t}\r\n\t})\r\n\t\t.then(function(json) {\r\n\t\t\treturn parseTree(json.res);\r\n\t\t});\r\n};\r\n\r\nconst _iterateNodeChilds = (node, level, out) => {\r\n\tlevel = level || 0;\r\n\tout = out || {\r\n\t\tlayers: []\r\n\t};\r\n\t\r\n\tif (node) {\r\n\t\tlet type = node.type,\r\n\t\t\tcontent = node.content,\r\n\t\t\tprops = content.properties;\r\n\t\tif (type === 'layer') {\r\n\t\t\tlet ph = { level: level, properties: props };\r\n\t\t\tif (content.geometry) { ph.geometry = content.geometry; }\r\n\t\t\tout.layers.push(ph);\r\n\t\t} else if (type === 'group') {\r\n\t\t\tlet childs = content.children || [];\r\n\t\t\tout.layers.push({ level: level, group: true, childsLen: childs.length, properties: props });\r\n\t\t\tchilds.map((it) => {\r\n\t\t\t\t_iterateNodeChilds(it, level + 1, out);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t} else {\r\n\t\treturn out;\r\n\t}\r\n\treturn out;\r\n};\r\n\r\nconst parseTree = (json) => {\r\n\tlet out = {};\r\n\tif (json.Status === 'error') {\r\n\t\tout = json;\r\n\t} else if (json.Result && json.Result.content) {\r\n\t\tout = _iterateNodeChilds(json.Result);\r\n\t\tout.mapAttr = out.layers.shift();\r\n\t}\r\n// console.log('______json_out_______', out, json)\r\n\treturn out;\r\n};\r\nconst getReq = url => {\r\n\treturn fetch(url, {\r\n\t\t\tmethod: 'get',\r\n\t\t\tmode: 'cors',\r\n\t\t\tcredentials: 'include'\r\n\t\t// headers: {'Accept': 'application/json'},\r\n\t\t// body: JSON.stringify(params)\t// TODO: сервер почему то не хочет работать так https://googlechrome.github.io/samples/fetch-api/fetch-post.html\r\n\t\t})\r\n\t\t.then(res => res.json())\r\n\t\t.catch(err => console.warn(err));\r\n};\r\n\r\nconst getLayerItems = (params) => {\r\n\tparams = params || {};\r\n\r\n\tlet url = `${serverBase}VectorLayer/Search.ashx`;\r\n\turl += '?layer=' + params.layerID;\r\n\tif (params.id) { '&query=gmx_id=' + params.id; }\r\n\r\n\turl += '&out_cs=EPSG:4326';\r\n\turl += '&geometry=true';\r\n\treturn getReq(url);\r\n};\r\nconst getReportsCount = () => {\r\n\treturn getReq(serverProxy + '?path=/rest/v1/get-current-user-info');\r\n};\r\n\r\nexport default {\r\n\tparseURLParams,\r\n\tgetMapTree,\r\n\tgetReportsCount,\r\n\tgetLayerItems\r\n};","import Requests from './Requests.js';\r\n\r\nvar _self = self;\r\n(_self.on || _self.addEventListener).call(_self, 'message', e => {\r\n    const message = e.data || e;\r\n// console.log('message ', e);\r\n    switch (message.cmd) {\r\n\t\tcase 'getLayerItems':\r\n\t\t\tRequests.getLayerItems({layerID: message.layerID}).then((json) => {\r\n\t\t\t\tmessage.out = json;\r\n\t\t\t\tlet pt = {};\r\n\t\t\t\tjson.Result.fields.forEach((name, i) => { pt[name] = i; });\r\n\t\t\t\tjson.Result.fieldKeys = pt;\r\n\t\t\t\t_self.postMessage(message);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tcase 'getMap':\r\n\t\t\tRequests.getMapTree({mapId: message.mapID, search: message.search}).then((json) => {\r\n\t\t\t\tmessage.out = json;\r\n\t\t\t\t_self.postMessage(message);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tcase 'getReportsCount':\r\n\t\t\tRequests.getReportsCount().then((json) => {\r\n\t\t\t\tmessage.out = json;\r\n\t\t\t\t_self.postMessage(message);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tconsole.warn('Неизвестная команда:', message.cmd);\r\n\t\t\tbreak;\r\n\t}\r\n});\r\n\r\n"],"names":["_self","self","window","serverBase","serverProxy","str","location","origin","_protocol","substring","indexOf","syncParams","fetchOptions","mode","redirect","credentials","parseURLParams","sp","URLSearchParams","search","out","arr","p","k","z","push","main","keys","utils","extend","dest","i","j","len","src","arguments","length","makeTileKeys","it","ptiles","tklen","tilesOrder","tiles","newTiles","t","splice","tk","join","tile","data","tp","x","y","v","s","d","getDataSource","id","hostName","getZoomRange","info","properties","styles","st","Math","min","MinZoom","max","MaxZoom","chkProtocol","url","substr","getFormBody","par","Object","map","key","encodeURIComponent","chkResponse","resp","type","status","Promise","reject","contentType","headers","get","blob","json","text","getJson","queue","params","options","opt","method","body","fetch","then","res","load","catch","err","error","toString","getTileAttributes","prop","tileAttributeIndexes","tileAttributeTypes","attributes","attrs","attrTypes","identityField","a","getMapTree","srs","skipTiles","mapId","folderId","visibleItemOnly","parseTree","_iterateNodeChilds","node","level","layers","content","props","ph","geometry","childs","children","group","childsLen","Status","Result","mapAttr","shift","getReq","console","warn","getLayerItems","layerID","getReportsCount","on","addEventListener","call","e","message","cmd","Requests","pt","fields","forEach","name","fieldKeys","postMessage","mapID"],"mappings":"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"}
{"version":3,"file":"index.js","sources":["../scripts/WorkerLoaderHelper.js","../src/worker/Requests.js","../src/index.js"],"sourcesContent":["const kIsNodeJS = Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]'; // eslint-disable-line\nconst kRequire = kIsNodeJS ? module.require : null; // eslint-disable-line\n\nexport function createInlineWorkerFactory(fn, sourcemap = null) {\n    const source = fn.toString();\n    const start = source.indexOf('\\n', 10) + 1;\n    const end = source.indexOf('}', source.length - 1);\n    const body = source.substring(start, end) + (sourcemap ? `//# sourceMappingURL=${sourcemap}` : '');\n    const blankPrefixLength = body.search(/\\S/);\n    const lines = body.split('\\n').map(line => line.substring(blankPrefixLength) + '\\n');\n\n    if (kIsNodeJS) {\n        /* node.js */\n        const Worker = kRequire('worker_threads').Worker; // eslint-disable-line\n        const concat = lines.join('\\n');\n        return function WorkerFactory(options) {\n            return new Worker(concat, Object.assign({}, options, { eval: true }));\n        };\n    }\n\n    /* browser */\n    const blob = new Blob(lines, { type: 'application/javascript' });\n    const url = URL.createObjectURL(blob);\n    return function WorkerFactory(options) {\n        return new Worker(url, options);\n    };\n}\n\nexport function createURLWorkerFactory(url) {\n    if (kIsNodeJS) {\n        /* node.js */\n        const Worker = kRequire('worker_threads').Worker; // eslint-disable-line\n        return function WorkerFactory(options) {\n            return new Worker(url, options);\n        };\n    }\n    /* browser */\n    return function WorkerFactory(options) {\n        return new Worker(url, options);\n    };\n}\n\nexport function createBase64WorkerFactory(base64, sourcemap = null) {\n    const source = kIsNodeJS ? Buffer.from(base64, 'base64').toString('ascii') : atob(base64); // eslint-disable-line\n    const start = source.indexOf('\\n', 10) + 1;\n    const body = source.substring(start) + (sourcemap ? `//# sourceMappingURL=${sourcemap}` : '');\n\n    if (kIsNodeJS) {\n        /* node.js */\n        const Worker = kRequire('worker_threads').Worker; // eslint-disable-line\n        return function WorkerFactory(options) {\n            return new Worker(body, Object.assign({}, options, { eval: true }));\n        };\n    }\n\n    /* browser */\n    const blob = new Blob([body], { type: 'application/javascript' });\n    const url = URL.createObjectURL(blob);\n    return function WorkerFactory(options) {\n        return new Worker(url, options);\n    };\n}\n","\r\nconst\t_self = self || window;\r\n\t\t// serverBase = _self.serverBase || 'maps.kosmosnimki.ru/',\r\n\t\t// serverProxy = serverBase + 'Plugins/ForestReport/proxy',\r\n\t\t// gmxProxy = '//maps.kosmosnimki.ru/ApiSave.ashx';\r\n\r\n// let _app = {},\r\n\t// loaderStatus = {},\r\n\t// _sessionKeys = {},\r\nlet str = _self.location.origin || '',\r\n\t_protocol = str.substring(0, str.indexOf('/')),\r\n\tsyncParams = {},\r\n\tfetchOptions = {\r\n\t\t// method: 'post',\r\n\t\t// headers: {'Content-type': 'application/x-www-form-urlencoded'},\r\n\t\tmode: 'cors',\r\n\t\t// redirect: 'follow',\r\n\t\tcredentials: 'include'\r\n\t};\r\n\r\nconst COMPARS = {WrapStyle: 'None', ftc: 'osm', srs: 3857};\r\n\r\nconst setSyncParams = (hash) => {\t// установка дополнительных параметров для серверных запросов\r\n\tsyncParams = hash;\r\n};\r\nconst getSyncParams = (stringFlag) => {\r\n\tvar res = syncParams;\r\n\tif (stringFlag) {\r\n\t\tvar arr = [];\r\n\t\tfor (var key in res) {\r\n\t\t\tarr.push(key + '=' + res[key]);\r\n\t\t}\r\n\t\tres = arr.join('&');\r\n\t}\r\n\treturn res;\r\n};\r\n\r\nconst parseURLParams = (str) => {\r\n\tlet sp = new URLSearchParams(str || location.search),\r\n\t\tout = {},\r\n\t\tarr = [];\r\n\tfor (let p of sp) {\r\n\t\tlet k = p[0], z = p[1];\r\n\t\tif (z) {\r\n\t\t\tif (!out[k]) {out[k] = [];}\r\n\t\t\tout[k].push(z);\r\n\t\t} else {\r\n\t\t\tarr.push(k);\r\n\t\t}\r\n\t}\r\n\treturn {main: arr, keys: out};\r\n};\r\nlet utils = {\r\n\textend: function (dest) {\r\n\t\tvar i, j, len, src;\r\n\r\n\t\tfor (j = 1, len = arguments.length; j < len; j++) {\r\n\t\t\tsrc = arguments[j];\r\n\t\t\tfor (i in src) {\r\n\t\t\t\tdest[i] = src[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dest;\r\n\t},\r\n\r\n\tmakeTileKeys: function(it, ptiles) {\r\n\t\tvar tklen = it.tilesOrder.length,\r\n\t\t\tarr = it.tiles,\r\n\t\t\ttiles = {},\r\n\t\t\tnewTiles = {};\r\n\r\n\t\twhile (arr.length) {\r\n\t\t\tvar t = arr.splice(0, tklen),\r\n\t\t\t\ttk = t.join('_'),\r\n\t\t\t\ttile = ptiles[tk];\r\n\t\t\tif (!tile || !tile.data) {\r\n\t\t\t\tif (!tile) {\r\n\t\t\t\t\ttiles[tk] = {\r\n\t\t\t\t\t\ttp: {z: t[0], x: t[1], y: t[2], v: t[3], s: t[4], d: t[5]}\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttiles[tk] = tile;\r\n\t\t\t\t}\r\n\t\t\t\tnewTiles[tk] = true;\r\n\t\t\t} else {\r\n\t\t\t\ttiles[tk] = tile;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {tiles: tiles, newTiles: newTiles};\r\n\t},\r\n\r\n\tgetZoomRange: function(info) {\r\n\t\tvar arr = info.properties.styles,\r\n\t\t\tout = [40, 0];\r\n\t\tfor (var i = 0, len = arr.length; i < len; i++) {\r\n\t\t\tvar st = arr[i];\r\n\t\t\tout[0] = Math.min(out[0], st.MinZoom);\r\n\t\t\tout[1] = Math.max(out[1], st.MaxZoom);\r\n\t\t}\r\n\t\tout[0] = out[0] === 40 ? 1 : out[0];\r\n\t\tout[1] = out[1] === 0 ? 22 : out[1];\r\n\t\treturn out;\r\n\t},\r\n\r\n\tchkProtocol: function(url) {\r\n\t\treturn url.substr(0, _protocol.length) === _protocol ? url : _protocol + url;\r\n\t},\r\n\tgetFormBody: function(par) {\r\n\t\treturn Object.keys(par).map(function(key) { return encodeURIComponent(key) + '=' + encodeURIComponent(par[key]); }).join('&');\r\n\t},\r\n\tchkResponse: function(resp, type) {\r\n\t\tif (resp.status < 200 || resp.status >= 300) {\t\t\t\t\t\t// error\r\n\t\t\treturn Promise.reject(resp);\r\n\t\t} else {\r\n\t\t\tvar contentType = resp.headers.get('Content-Type');\r\n\t\t\tif (type === 'bitmap') {\t\t\t\t\t\t\t\t\t\t\t\t// get blob\r\n\t\t\t\treturn resp.blob();\r\n\t\t\t} else if (contentType.indexOf('application/json') > -1) {\t\t\t\t// application/json; charset=utf-8\r\n\t\t\t\treturn resp.json();\r\n\t\t\t} else if (contentType.indexOf('text/javascript') > -1) {\t \t\t\t// text/javascript; charset=utf-8\r\n\t\t\t\treturn resp.text();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.text();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.formData();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.arrayBuffer();\r\n\t\t\t// } else {\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn resp.text();\r\n\t},\r\n\tgetBitMap: function(url) {\r\n\t\tlet options = {type: 'bitmap'};\r\n\t\treturn fetch(url, options)\r\n\t\t.then(function(res) {\r\n\t\t\treturn utils.chkResponse(res, options.type);\r\n\t\t// })\r\n\t\t// .then(function(blob) {\r\n\t\t\t// return createImageBitmap(blob, {\r\n\t\t\t\t// premultiplyAlpha: 'none',\r\n\t\t\t\t// colorSpaceConversion: 'none'\r\n\t\t\t// });\r\n\t\t});\r\n\t},\r\n\tgetTileJson: function(queue) {\r\n\t\tlet params = queue.params || {};\r\n\t\tif (queue.paramsArr) {\r\n\t\t\tqueue.paramsArr.forEach((it) => {\r\n\t\t\t\tparams = utils.extend(params, it);\r\n\t\t\t});\r\n\t\t}\r\n\t\tlet par = utils.extend({}, fetchOptions, COMPARS, params, syncParams),\r\n\t\t\toptions = queue.options || {};\r\n\t\treturn fetch(queue.url + '?' + utils.getFormBody(par))\r\n\t\t.then(function(res) {\r\n\t\t\treturn utils.chkResponse(res, options.type);\r\n\t\t});\r\n\t},\r\n\tgetJson: function(queue) {\r\n\t\tlet params = queue.params || {};\r\n\t\tif (queue.paramsArr) {\r\n\t\t\tqueue.paramsArr.forEach((it) => {\r\n\t\t\t\tparams = utils.extend(params, it);\r\n\t\t\t});\r\n\t\t}\r\n\t\tlet par = utils.extend({}, params, syncParams),\r\n\t\t\toptions = queue.options || {},\r\n\t\t\topt = utils.extend({\r\n\t\t\t\tmethod: 'post',\r\n\t\t\t\theaders: {'Content-type': 'application/x-www-form-urlencoded'}\r\n\t\t\t}, fetchOptions, options, {\r\n\t\t\t\tbody: utils.getFormBody(par)\r\n\t\t\t});\r\n\t\treturn fetch(utils.chkProtocol(queue.url), opt)\r\n\t\t.then(function(res) {\r\n\t\t\treturn utils.chkResponse(res, options.type);\r\n\t\t})\r\n\t\t.then(function(res) {\r\n\t\t\treturn {url: queue.url, queue: queue, load: true, res: res};\r\n\t\t})\r\n\t\t.catch(function(err) {\r\n\t\t\treturn {url: queue.url, queue: queue, load: false, error: err.toString()};\r\n\t\t\t// handler.workerContext.postMessage(out);\r\n\t\t});\r\n    },\r\n\r\n\tgeoItemBounds: function(geo) {  // get item bounds array by geometry\r\n        if (!geo) {\r\n            return {\r\n                bounds: null,\r\n                boundsArr: []\r\n            };\r\n        }\r\n        var type = geo.type,\r\n            coords = geo.coordinates,\r\n            b = null,\r\n            i = 0,\r\n            len = 0,\r\n            bounds = null,\r\n            boundsArr = [];\r\n        if (type === 'MULTIPOLYGON' || type === 'MultiPolygon') {\r\n            bounds = new Bounds();\r\n            for (i = 0, len = coords.length; i < len; i++) {\r\n                var arr1 = [];\r\n                for (var j = 0, len1 = coords[i].length; j < len1; j++) {\r\n                    b = new Bounds(coords[i][j]);\r\n                    arr1.push(b);\r\n                    if (j === 0) { bounds.extendBounds(b); }\r\n                }\r\n                boundsArr.push(arr1);\r\n            }\r\n        } else if (type === 'POLYGON' || type === 'Polygon') {\r\n            bounds = new Bounds();\r\n            for (i = 0, len = coords.length; i < len; i++) {\r\n                b = new Bounds(coords[i]);\r\n                boundsArr.push(b);\r\n                if (i === 0) { bounds.extendBounds(b); }\r\n            }\r\n        } else if (type === 'POINT' || type === 'Point') {\r\n            bounds = new Bounds([coords]);\r\n        } else if (type === 'MULTIPOINT' || type === 'MultiPoint') {\r\n            bounds = new Bounds();\r\n            for (i = 0, len = coords.length; i < len; i++) {\r\n                b = new Bounds([coords[i]]);\r\n                bounds.extendBounds(b);\r\n            }\r\n        } else if (type === 'LINESTRING' || type === 'LineString') {\r\n            bounds = new Bounds(coords);\r\n            //boundsArr.push(bounds);\r\n        } else if (type === 'MULTILINESTRING' || type === 'MultiLineString') {\r\n            bounds = new Bounds();\r\n            for (i = 0, len = coords.length; i < len; i++) {\r\n                b = new Bounds(coords[i]);\r\n                bounds.extendBounds(b);\r\n                //boundsArr.push(b);\r\n            }\r\n        }\r\n        return {\r\n            bounds: bounds,\r\n            boundsArr: boundsArr\r\n        };\r\n    }\r\n\r\n};\r\n/*\r\nconst requestSessionKey = (serverHost, apiKey) => {\r\n\tlet keys = _sessionKeys;\r\n\tif (!(serverHost in keys)) {\r\n\t\tkeys[serverHost] = new Promise(function(resolve, reject) {\r\n\t\t\tif (apiKey) {\r\n\t\t\t\tutils.getJson({\r\n\t\t\t\t\turl: '//' + serverHost + '/ApiKey.ashx',\r\n\t\t\t\t\tparams: {WrapStyle: 'None', Key: apiKey}\r\n\t\t\t\t})\r\n\t\t\t\t\t.then(function(json) {\r\n\t\t\t\t\t\tlet res = json.res;\r\n\t\t\t\t\t\tif (res.Status === 'ok' && res.Result) {\r\n\t\t\t\t\t\t\tresolve(res.Result.Key !== 'null' ? '' : res.Result.Key);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treject(json);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(function() {\r\n\t\t\t\t\t\tresolve('');\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tresolve('');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn keys[serverHost];\r\n};\r\nlet _maps = {};\r\nconst getMapTree = (pars) => {\r\n\tpars = pars || {};\r\n\tlet hostName = pars.hostName || serverBase,\r\n\t\tid = pars.mapId;\r\n\treturn utils.getJson({\r\n\t\turl: '//' + hostName + '/Map/GetMapFolder',\r\n\t\t// options: {},\r\n\t\tparams: {\r\n\t\t\tsrs: 3857, \r\n\t\t\tskipTiles: 'All',\r\n\r\n\t\t\tmapId: id,\r\n\t\t\tfolderId: 'root',\r\n\t\t\tvisibleItemOnly: false\r\n\t\t}\r\n\t})\r\n\t\t.then(function(json) {\r\n\t\t\tlet out = parseTree(json.res);\r\n\t\t\t_maps[hostName] = _maps[hostName] || {};\r\n\t\t\t_maps[hostName][id] = out;\r\n\t\t\treturn parseTree(out);\r\n\t\t});\r\n};\r\nconst getReq = url => {\r\n\treturn fetch(url, {\r\n\t\t\tmethod: 'get',\r\n\t\t\tmode: 'cors',\r\n\t\t\tcredentials: 'include'\r\n\t\t// headers: {'Accept': 'application/json'},\r\n\t\t// body: JSON.stringify(params)\t// TODO: сервер почему то не хочет работать так https://googlechrome.github.io/samples/fetch-api/fetch-post.html\r\n\t\t})\r\n\t\t.then(res => res.json())\r\n\t\t.catch(err => console.warn(err));\r\n};\r\n\r\n// const getLayerItems = (params) => {\r\n\t// params = params || {};\r\n\r\n\t// let url = `${serverBase}VectorLayer/Search.ashx`;\r\n\t// url += '?layer=' + params.layerID;\r\n\t// if (params.id) { '&query=gmx_id=' + params.id; }\r\n\r\n\t// url += '&out_cs=EPSG:4326';\r\n\t// url += '&geometry=true';\r\n\t// return getReq(url);\r\n// };\r\n// const getReportsCount = () => {\r\n\t// return getReq(serverProxy + '?path=/rest/v1/get-current-user-info');\r\n// };\r\n\r\nlet dataSources = {},\r\n\tloaderStatus1 = {};\r\n\r\nconst addDataSource = (pars) => {\r\n\tpars = pars || {};\r\n\r\n\tlet id = pars.id;\r\n\tif (id) {\r\n\t\tlet hostName = pars.hostName;\r\n\t\t\r\n\t} else {\r\n\t\tconsole.warn('Warning: Specify layer \\'id\\' and \\'hostName\\`', pars);\r\n\t}\r\nconsole.log('addDataSource:', pars);\r\n\treturn;\r\n};\r\n\r\nconst removeDataSource = (pars) => {\r\n\tpars = pars || {};\r\n\r\n\tlet id = pars.id;\r\n\tif (id) {\r\n\t\tlet hostName = pars.hostName;\r\n\t\t\r\n\t} else {\r\n\t\tconsole.warn('Warning: Specify layer \\'id\\' and \\'hostName\\`', pars);\r\n\t}\r\nconsole.log('removeDataSource:', pars);\r\n\t//Requests.removeDataSource({id: message.layerID, hostName: message.hostName}).then((json) => {\r\n\treturn;\r\n};\r\nlet _maps = {};\r\nconst getMapTree = (pars) => {\r\n\tpars = pars || {};\r\n\tlet hostName = pars.hostName || 'maps.kosmosnimki.ru',\r\n\t\tid = pars.mapID;\r\n\treturn utils.getJson({\r\n\t\turl: '//' + hostName + '/Map/GetMapFolder',\r\n\t\t// options: {},\r\n\t\tparams: {\r\n\t\t\tsrs: 3857, \r\n\t\t\tskipTiles: 'All',\r\n\r\n\t\t\tmapId: id,\r\n\t\t\tfolderId: 'root',\r\n\t\t\tvisibleItemOnly: false\r\n\t\t}\r\n\t})\r\n\t\t// .then(function(json) {\r\n\t\t\t// let out = parseTree(json.res);\r\n\t\t\t// _maps[hostName] = _maps[hostName] || {};\r\n\t\t\t// _maps[hostName][id] = out;\r\n\t\t\t// return parseTree(out);\r\n\t\t// });\r\n};\r\n\r\nconst _iterateNodeChilds = (node, level, out) => {\r\n\tlevel = level || 0;\r\n\tout = out || {\r\n\t\tlayers: []\r\n\t};\r\n\t\r\n\tif (node) {\r\n\t\tlet type = node.type,\r\n\t\t\tcontent = node.content,\r\n\t\t\tprops = content.properties;\r\n\t\tif (type === 'layer') {\r\n\t\t\tlet ph = utils.parseLayerProps(props);\r\n\t\t\tph.level = level;\r\n\t\t\tif (content.geometry) { ph.geometry = content.geometry; }\r\n\t\t\tout.layers.push(ph);\r\n\t\t} else if (type === 'group') {\r\n\t\t\tlet childs = content.children || [];\r\n\t\t\tout.layers.push({ level: level, group: true, childsLen: childs.length, properties: props });\r\n\t\t\tchilds.map((it) => {\r\n\t\t\t\t_iterateNodeChilds(it, level + 1, out);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t} else {\r\n\t\treturn out;\r\n\t}\r\n\treturn out;\r\n};\r\n\r\nconst parseTree = (json) => {\r\n\tlet out = {};\r\n\tif (json.Status === 'error') {\r\n\t\tout = json;\r\n\t} else if (json.Result && json.Result.content) {\r\n\t\tout = _iterateNodeChilds(json.Result);\r\n\t\tout.mapAttr = out.layers.shift();\r\n\t}\r\n// console.log('______json_out_______', out, json)\r\n\treturn out;\r\n};\r\n*/\r\n\r\nconst chkSignal = (signalName, signals, opt) => {\r\n\topt = opt || {};\r\n\tlet sObj = signals[signalName];\r\n// console.log('sssssss', sObj, signalName)\r\n\tif (sObj) { sObj.abort(); }\r\n\tsObj = signals[signalName] = new AbortController();\r\n\tsObj.signal.addEventListener('abort', (ev) => console.log('Отмена fetch:', ev));\r\n\topt.signal = sObj.signal;\r\n\tsignals[signalName] = sObj;\r\n\treturn opt;\r\n};\r\n\r\nconst Bounds = function(arr) {\r\n    this.min = {\r\n        x: Number.MAX_VALUE,\r\n        y: Number.MAX_VALUE\r\n    };\r\n    this.max = {\r\n        x: -Number.MAX_VALUE,\r\n        y: -Number.MAX_VALUE\r\n    };\r\n    this.extendArray(arr);\r\n};\r\nBounds.prototype = {\r\n    extend: function(x, y) {\r\n        if (x < this.min.x) { this.min.x = x; }\r\n        if (x > this.max.x) { this.max.x = x; }\r\n        if (y < this.min.y) { this.min.y = y; }\r\n        if (y > this.max.y) { this.max.y = y; }\r\n        return this;\r\n    },\r\n    extendBounds: function(bounds) {\r\n        return this.extendArray([[bounds.min.x, bounds.min.y], [bounds.max.x, bounds.max.y]]);\r\n    },\r\n    extendArray: function(arr) {\r\n        if (!arr || !arr.length) { return this; }\r\n        var i, len;\r\n        if (typeof arr[0] === 'number') {\r\n            for (i = 0, len = arr.length; i < len; i += 2) {\r\n                this.extend(arr[i], arr[i + 1]);\r\n            }\r\n        } else {\r\n            for (i = 0, len = arr.length; i < len; i++) {\r\n                this.extend(arr[i][0], arr[i][1]);\r\n            }\r\n        }\r\n        return this;\r\n    },\r\n    addBuffer: function(dxmin, dymin, dxmax, dymax) {\r\n        this.min.x -= dxmin;\r\n        this.min.y -= dymin || dxmin;\r\n        this.max.x += dxmax || dxmin;\r\n        this.max.y += dymax || dymin || dxmin;\r\n        return this;\r\n    },\r\n    contains: function (point) { // ([x, y]) -> Boolean\r\n        var min = this.min, max = this.max,\r\n            x = point[0], y = point[1];\r\n        return x >= min.x && x <= max.x && y >= min.y && y <= max.y;\r\n    },\r\n    getCenter: function () {\r\n        var min = this.min, max = this.max;\r\n        return [(min.x + max.x) / 2, (min.y + max.y) / 2];\r\n    },\r\n    addOffset: function (offset) {\r\n        this.min.x += offset[0]; this.max.x += offset[0];\r\n        this.min.y += offset[1]; this.max.y += offset[1];\r\n        return this;\r\n    },\r\n    intersects: function (bounds) { // (Bounds) -> Boolean\r\n        var min = this.min,\r\n            max = this.max,\r\n            min2 = bounds.min,\r\n            max2 = bounds.max;\r\n        return max2.x > min.x && min2.x < max.x && max2.y > min.y && min2.y < max.y;\r\n    },\r\n    intersectsWithDelta: function (bounds, dx, dy) { // (Bounds, dx, dy) -> Boolean\r\n        var min = this.min,\r\n            max = this.max,\r\n            x = dx || 0,\r\n            y = dy || 0,\r\n            min2 = bounds.min,\r\n            max2 = bounds.max;\r\n        return max2.x + x > min.x && min2.x - x < max.x && max2.y + y > min.y && min2.y - y < max.y;\r\n    },\r\n    isEqual: function (bounds) { // (Bounds) -> Boolean\r\n        var min = this.min,\r\n            max = this.max,\r\n            min2 = bounds.min,\r\n            max2 = bounds.max;\r\n        return max2.x === max.x && min2.x === min.x && max2.y === max.y && min2.y === min.y;\r\n    },\r\n    isNodeIntersect: function (coords) {\r\n        for (var i = 0, len = coords.length; i < len; i++) {\r\n            if (this.contains(coords[i])) {\r\n                return {\r\n                    num: i,\r\n                    point: coords[i]\r\n                };\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n};\r\n\r\n    // bounds: function(arr) {\r\n\t\t// return new Bounds(arr);\r\n    // },\r\n\r\nexport default {\r\n\tbounds: arr => new Bounds(arr),\r\n\tgeoItemBounds: utils.geoItemBounds,\r\n\tchkSignal,\r\n\tCOMPARS,\r\n\tsetSyncParams,\r\n\tgetSyncParams,\r\n\tparseURLParams,\r\n\t// getMapTree,\r\n\textend: utils.extend,\r\n\tgetBitMap: utils.getBitMap,\r\n\tgetFormBody: utils.getFormBody,\r\n\tgetTileJson: utils.getTileJson,\r\n\tgetJson: utils.getJson\r\n\t// addDataSource,\r\n\t// removeDataSource,\r\n\t// getReportsCount,\r\n\t// getLayerItems\r\n};","import DataWorker from 'web-worker:./worker';\r\nimport Requests from './worker/Requests.js';\r\nimport L from 'leaflet';\r\n\r\nconst dataWorker = new DataWorker();\nconst urlPars = Requests.parseURLParams();\n\t\tconsole.log('urlPars', urlPars);\n\r\nlet reqNeedResolve = {};\r\ndataWorker.onmessage = (res) => {\r\n\tlet data = res.data,\r\n\t\tcode = data.code,\r\n\t\tpt = reqNeedResolve[code],\r\n\t\tjson = data.out;\r\n// console.log('onmessage _____________', code, res);\r\n\tif (pt && pt.resolve) {\r\n\t\tif (data.bitmap) {\r\n\t\t\tjson.bitmap = data.bitmap;\r\n\t\t}\r\n// console.log('resolve _____________', json);\r\n\t\tpt.resolve(json);\r\n// console.log('resolve 1 _____________', json);\r\n\t\tdelete reqNeedResolve[code];\r\n\t}\r\n};\r\n\r\nconst WORLDWIDTHFULL = 40075016.685578496,\r\n\tW = WORLDWIDTHFULL / 2,\r\n\t// WORLDBBOX = JSON.stringify([[-W, -W, W, W]]);\r\n\tWORLDBBOX = [[-W, -W, W, W]];\r\n//dataWorker.postMessage('Hello World!');\r\nconst Utils = {\r\n\r\n    getStyleAtlas: (styles) => {\r\n\t\tlet res = styles.map(st => {\r\n\t\t\tconst rst = st.RenderStyle,\r\n\t\t\t\tcancelProm = new Promise(resolve => resolve(null));\r\n            if (!rst || !rst.iconUrl) {\r\n\t\t\t\treturn cancelProm;\r\n\t\t\t} else {\r\n\t\t\t\treturn fetch(rst.iconUrl, {mode: 'cors', type: 'bitmap'})\r\n\t\t\t\t\t.then(req => req.blob())\r\n\t\t\t\t\t// .then(blob => createImageBitmap(blob, { premultiplyAlpha: 'none', colorSpaceConversion: 'none', }))\r\n\t\t\t\t\t.catch((err) => { console.warn(err); return cancelProm;});\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn Promise.all(res).then(arr => {\r\n\t\t\tconsole.log('getStyleAtlas', arr);\r\n\t\t});\r\n\r\n// async function loadNextImage() {\r\n  // const url = `${imageUrls[imgNdx]}?cachebust=${performance.now()}`;\r\n  // imgNdx = (imgNdx + 1) % imageUrls.length;\r\n  // const res = await fetch(url, {mode: 'cors'});\r\n  // const blob = await res.blob();\r\n  // const bitmap = await createImageBitmap(blob, {\r\n    // premultiplyAlpha: 'none',\r\n    // colorSpaceConversion: 'none',\r\n  // });\r\n  // if (update) {\r\n    // gl.bindTexture(gl.TEXTURE_2D, tex);\r\n    // gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, bitmap);\r\n    // imgAspect = bitmap.width / bitmap.height;\r\n  // }\r\n  // setTimeout(loadNextImage, 1000);\r\n// }\r\n    },\r\n\r\n\tgetBboxes: function(map) {\r\n\t\tif (map.options.allWorld) {\r\n\t\t\treturn WORLDBBOX;\r\n\t\t}\r\n\t\tlet bbox = map.getBounds(),\r\n\t\t\tne = bbox.getNorthEast(),\r\n\t\t\tsw = bbox.getSouthWest();\r\n\t\tif ((ne.lng - sw.lng) > 180) {\r\n\t\t\treturn WORLDBBOX;\r\n\t\t}\r\n\t\tlet zoom = map.getZoom(),\r\n\t\t\tts = L.gmxUtil.tileSizes[zoom],\r\n\t\t\tpb = {x: ts, y: ts},\r\n\t\t\tmbbox = L.bounds(\r\n\t\t\t\tL.CRS.EPSG3857.project(sw)._subtract(pb),\r\n\t\t\t\tL.CRS.EPSG3857.project(ne)._add(pb)\r\n\t\t\t),\r\n\r\n\t\t\tminY = mbbox.min.y, maxY = mbbox.max.y,\r\n\t\t\tminX = mbbox.min.x, maxX = mbbox.max.x,\r\n\t\t\tminX1 = null, maxX1 = null,\r\n\t\t\tww = WORLDWIDTHFULL,\r\n\t\t\tsize = mbbox.getSize(),\r\n\t\t\tout = [];\r\n\r\n\t\tif (size.x > ww) {\r\n\t\t\treturn WORLDBBOX;\r\n\t\t}\r\n\r\n\t\tif (maxX > W || minX < -W) {\r\n\t\t\tvar hs = size.x / 2,\r\n\t\t\t\tcenter = ((maxX + minX) / 2) % ww;\r\n\r\n\t\t\tcenter = center + (center > W ? -ww : (center < -W ? ww : 0));\r\n\t\t\tminX = center - hs; maxX = center + hs;\r\n\t\t\tif (minX < -W) {\r\n\t\t\t\tminX1 = minX + ww; maxX1 = W; minX = -W;\r\n\t\t\t} else if (maxX > W) {\r\n\t\t\t\tminX1 = -W; maxX1 = maxX - ww; maxX = W;\r\n\t\t\t}\r\n\t\t}\r\n\t\tout.push([minX, minY, maxX, maxY]);\r\n\r\n\t\tif (minX1) {\r\n\t\t\tout.push([minX1, minY, maxX1, maxY]);\r\n\t\t}\r\n\t\treturn out;\r\n\t\t// return JSON.stringify(out);\r\n\t},\r\n\r\n\tsetSyncParams: (syncParams) => {\r\n\t\tsyncParams = syncParams || {};\r\n\t\t// dataWorker.onmessage = (res) => {\r\n\t\t\t// if (res.data.cmd === 'setSyncParams') {\r\n\t\t\t\t// console.log('onmessage setSyncParams ', res);\r\n\t\t\t// }\r\n\t\t// };\r\n\t\tdataWorker.postMessage({cmd: 'setSyncParams', syncParams: syncParams});\r\n\t},\r\n\tgetSyncParams: (stringFlag) => {\r\n        return new Promise(() => {\r\n\t\t\t// dataWorker.onmessage = (res) => {\r\n\t\t\t\t// if (res.data.cmd === 'getSyncParams') {\r\n\t\t\t\t\t// resolve(res.data.syncParams);\r\n\t\t\t\t\t// console.log('onmessage getSyncParams ', res);\r\n\t\t\t\t// }\r\n\t\t\t// };\r\n\t\t\tdataWorker.postMessage({cmd: 'getSyncParams', stringFlag: stringFlag});\r\n\t\t});\r\n\t},\r\n\tsetDateInterval: (dateInterval, id, hostName) => {\r\n\t\tconsole.log('setDateInterval', dateInterval, id, hostName)\r\n\r\n\t\treturn new Promise(() => {\r\n\t\t\t// dataWorker.onmessage = (res) => {\r\n\t\t\t\t// if (res.data.cmd === 'setDateInterval') { resolve(res.data); }\r\n\t\t\t// };\r\n\t\t\tdataWorker.postMessage({\r\n\t\t\t\tcmd: 'setDateInterval',\r\n\t\t\t\tid: id,\r\n\t\t\t\thostName: hostName || 'maps.kosmosnimki.ru',\r\n\t\t\t\tdateBegin: Math.floor(dateInterval.beginDate.getTime() / 1000),\r\n\t\t\t\tdateEnd: Math.floor(dateInterval.endDate.getTime() / 1000)\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\tgetTiles: (opt) => {\r\n\t\tlet code = 'getTiles_' + JSON.stringify(opt.coords || {});\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\treqNeedResolve[code] = {resolve: resolve};\r\n\t\t\topt.code = code;\r\n\t\t\topt.cmd = 'getTiles';\r\n\t\t\tdataWorker.postMessage(opt);\r\n\t\t});\r\n\t},\r\n\taddCanvasTile: (opt) => {\r\n\t\tlet code = 'addCanvasTile_' + JSON.stringify(opt.coords || {});\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\treqNeedResolve[code] = {resolve: resolve};\r\n\t\t\t// dataWorker.onmessage = (res) => {\r\n\t\t// console.log('addObserver___res____ ', res);\r\n\t\t\t\t// if (res.data.cmd === 'addObserver') { resolve(res.data); }\r\n\t\t\t// };\r\n\t\t\topt.code = code;\r\n\t\t\topt.cmd = 'addCanvasTile';\r\n\t\t\tdataWorker.postMessage(opt);\r\n\t\t\t// dataWorker.postMessage(opt, [opt.canvas]);\r\n\t\t});\r\n\t},\r\n\taddObserver: (opt) => {\r\n\t\treturn new Promise(() => {\r\n\t\t\t// dataWorker.onmessage = (res) => {\r\n\t\t// console.log('addObserver___res____ ', res);\r\n\t\t\t\t// if (res.data.cmd === 'addObserver') { resolve(res.data); }\r\n\t\t\t// };\r\n\t\t\topt.cmd = 'addObserver';\r\n\t\t\tdataWorker.postMessage(opt);\r\n\t\t});\r\n\t},\r\n\tremoveObserver: (opt) => {\r\n\t\topt.cmd = 'removeObserver';\r\n\t\tdataWorker.postMessage(opt);\r\n\t},\r\n\tgetMap: (opt) => {\r\n\t\topt = opt || {};\r\n        return new Promise((resolve) => {\r\n\t\t\tlet mapID = urlPars.main.length ? urlPars.main[0] : opt.mapID,\r\n\t\t\t\tcode = 'getMap_' + mapID;\r\n\t\t\t// let mapID = urlPars.main.length ? urlPars.main[0] : opt.mapID, hostName: opt.hostName, search: location.search});\r\n\r\n\t\t\t// dataWorker.onmessage = (res) => {\r\n\t\t\t\t// let data = res.data,\r\n\t\t\t\t\t// cmd = data.cmd,\r\n\t\t\t\t\t// json = data.out;\r\n\r\n\t\t\t\t// if (cmd === 'getMap') {\r\n\t\t\t\t\t// resolve(json);\r\n\t\t\t\t// }\r\n\t\t// console.log('getMap _____________', json);\r\n\t\t\t// };\r\n\t\t\t\r\n\t\t\treqNeedResolve[code] = {resolve: resolve};\r\n\t\t\tdataWorker.postMessage({\r\n\t\t\t\tcode: code,\r\n\t\t\t\tcmd: 'getMap',\r\n\t\t\t\tmapID: mapID\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n};\r\n\nL.Map.addInitHook(function () {\n\tlet map = this;\n\tmap\n\t\t.on('layeradd', (ev) => {\n\t\t\tif (ev.layer._gmx) {\r\n\t\t\t\tlet layer = ev.layer,\r\n\t\t\t\t\t// gmxProps = layer.getGmxProperties(),\r\n\t\t\t\t\t_gmx = layer._gmx,\r\n\t\t\t\t\tdm = layer.getDataManager(),\r\n\t\t\t\t\topt = dm.options,\r\n\t\t\t\t\tid = opt.name,\r\n\t\t\t\t\thostName = opt.hostName,\r\n\t\t\t\t\tdtInterval = dm.getMaxDateInterval(),\r\n\t\t\t\t\tbeginDate = dtInterval.beginDate || _gmx.beginDate,\r\n\t\t\t\t\tendDate = dtInterval.endDate || _gmx.endDate,\r\n\t\t\t\t\tpars = {\r\n\t\t\t\t\t\tcmd: 'addDataSource',\r\n\t\t\t\t\t\tid: id,\r\n\t\t\t\t\t\tvid: _gmx.layerID,\r\n\t\t\t\t\t\tvHostName: _gmx.hostName,\r\n\t\t\t\t\t\t// v: opt.LayerVersion,\r\n\t\t\t\t\t\t// gmxStyles: gmxProps.gmxStyles,\r\n\t\t\t\t\t\thostName: hostName,\r\n\t\t\t\t\t\tbbox: Utils.getBboxes(map),\r\n\t\t\t\t\t\tzoom: map.getZoom()\r\n\t\t\t\t\t};\r\n\t\t\t\tif (window.apiKey && hostName === 'maps.kosmosnimki.ru') {\r\n\t\t\t\t\tpars.apiKey = window.apiKey;\r\n\t\t\t\t}\r\n\t\t\t\tif (beginDate) {\r\n\t\t\t\t\tpars.dateBegin = Math.floor(beginDate.getTime() / 1000);\r\n\t\t\t\t}\r\n\t\t\t\tif (endDate) {\r\n\t\t\t\t\tpars.dateEnd = Math.floor(endDate.getTime() / 1000);\r\n\t\t\t\t}\r\n\t\t\t\tif (map.options.generalized === false) {\r\n\t\t\t\t\tpars.generalizedTiles = false;\r\n\t\t\t\t}\r\n\t\t\t\tlet arr = layer.getStyles();\r\nconsole.log('layeradd styles', arr, Utils.getStyleAtlas(arr));\r\n\r\n\n\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\tif (_gmx) {\n\t\t\t\t\t\t// dataWorker.onmessage = (res) => {\n\t\t\t\t\t\t\t// let data = res.data,\n\t\t\t\t\t\t\t\t// cmd = data.cmd,\n\t\t\t\t\t\t\t\t// json = data.out;\n\n\t\t\t\t\t\t\t// if (cmd === 'addDataSource') {\n\t\t\t\t\t\t\t\t// resolve(json);\n\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t// };\n\t\t\t\t\t\tdataWorker.postMessage(pars);\r\n\t\t\t\t\t\tdm.on('onDateInterval', (ev) => {\r\n\t\t\t\t\t\t\tUtils.setDateInterval({beginDate: ev.beginDate, endDate: ev.endDate}, id, hostName);\r\n\t\t\t\t\t\t});\r\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve({error: 'Not Geomixer layer'});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\r\n\t\t})\r\n\t\t.on('moveend', () => {\r\n\t\t\tdataWorker.postMessage({\r\n\t\t\t\tcmd: 'moveend',\r\n\t\t\t\tbbox: Utils.getBboxes(map),\r\n\t\t\t\tzoom: map.getZoom()\r\n\t\t\t});\r\n\t\t})\r\n\t\t.on('layerremove', (ev) => {\r\n\t// console.log('layerremove', ev);\n\t\t\tlet it = ev.layer,\n\t\t\t\t_gmx = it._gmx;\n\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tif (_gmx) {\n\t\t\t\t\t// dataWorker.onmessage = (res) => {\n\t\t\t\t\t\t// let data = res.data,\n\t\t\t\t\t\t\t// cmd = data.cmd,\n\t\t\t\t\t\t\t// json = data.out;\n\n\t\t\t\t\t\t// if (cmd === 'removeDataSource') {\n\t\t\t\t\t\t\t// resolve(json);\n\t\t\t\t\t\t// }\n\t\t\t\t\t// };\n\t\t\t\t\tdataWorker.postMessage({cmd: 'removeDataSource', id: _gmx.layerID, hostName: _gmx.hostName});\n\t\t\t\t} else {\n\t\t\t\t\tresolve({error: 'Not Geomixer layer'});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t// Utils.getMap({mapID: 'G1XRF'})\n\t\t// .then((res) => {\r\n\t\t\t// console.log('sss', res);\r\n\t\t// });\n/*\r\n\tvar htmlCanvas = L.DomUtil.create(\"canvas\", 'htmlCanvas');\r\n\thtmlCanvas.width = htmlCanvas.height = 256;\r\n\tdocument.body.appendChild(htmlCanvas);\r\n\t\r\n\tvar offscreen = htmlCanvas.transferControlToOffscreen();\r\n\r\n\t// var worker = new Worker(\"offscreencanvas.js\"); \r\n\tL.dataWorker.postMessage({\r\n\t\tcmd: 'testCanvas',\r\n\t\tcanvas: offscreen,\r\n\t\t_parts: [[{\"x\":54,\"y\":4},{\"x\":95,\"y\":40},{\"x\":95,\"y\":88}]],\r\n\t\toptions: {\r\n\t\t\tfillRule: 'evenodd',\r\n\t\t\t_dashArray: null,\r\n\t\t\tlineCap: \"butt\",\r\n\t\t\tlineJoin: \"round\",\r\n\t\t\tcolor: \"green\",\r\n\t\t\tfillColor: \"blue\",\r\n\t\t\tinteractive: true,\r\n\t\t\tsmoothFactor: 1,\r\n\t\t\tweight: 10,\r\n\t\t\topacity: 1,\r\n\t\t\tfillOpacity: 1,\r\n\t\t\tstroke: true,\r\n\t\t\tfill: false\r\n\t\t}\r\n\t}, [offscreen]);\r\n*/\n});\r\n\nL.gmxWorker = Utils;\r\nL.dataWorker = dataWorker;\r\n\r\nexport {dataWorker, Utils};"],"names":["_self","self","window","str","location","origin","_protocol","substring","indexOf","syncParams","fetchOptions","mode","credentials","COMPARS","WrapStyle","ftc","srs","setSyncParams","hash","getSyncParams","stringFlag","res","arr","key","push","join","parseURLParams","sp","URLSearchParams","search","out","p","k","z","main","keys","utils","extend","dest","i","j","len","src","arguments","length","makeTileKeys","it","ptiles","tklen","tilesOrder","tiles","newTiles","t","splice","tk","tile","data","tp","x","y","v","s","d","getZoomRange","info","properties","styles","st","Math","min","MinZoom","max","MaxZoom","chkProtocol","url","substr","getFormBody","par","Object","map","encodeURIComponent","chkResponse","resp","type","status","Promise","reject","contentType","headers","get","blob","json","text","getBitMap","options","fetch","then","getTileJson","queue","params","paramsArr","forEach","getJson","opt","method","body","load","catch","err","error","toString","geoItemBounds","geo","bounds","boundsArr","coords","coordinates","b","Bounds","arr1","len1","extendBounds","chkSignal","signalName","signals","sObj","abort","AbortController","signal","addEventListener","ev","console","log","Number","MAX_VALUE","extendArray","prototype","addBuffer","dxmin","dymin","dxmax","dymax","contains","point","getCenter","addOffset","offset","intersects","min2","max2","intersectsWithDelta","dx","dy","isEqual","isNodeIntersect","num","dataWorker","DataWorker","urlPars","Requests","reqNeedResolve","onmessage","code","pt","resolve","bitmap","WORLDWIDTHFULL","W","WORLDBBOX","Utils","getStyleAtlas","rst","RenderStyle","cancelProm","iconUrl","req","warn","all","getBboxes","allWorld","bbox","getBounds","ne","getNorthEast","sw","getSouthWest","lng","zoom","getZoom","ts","L","gmxUtil","tileSizes","pb","mbbox","CRS","EPSG3857","project","_subtract","_add","minY","maxY","minX","maxX","minX1","maxX1","ww","size","getSize","hs","center","postMessage","cmd","setDateInterval","dateInterval","id","hostName","dateBegin","floor","beginDate","getTime","dateEnd","endDate","getTiles","JSON","stringify","addCanvasTile","addObserver","removeObserver","getMap","mapID","Map","addInitHook","on","layer","_gmx","dm","getDataManager","name","dtInterval","getMaxDateInterval","pars","vid","layerID","vHostName","apiKey","generalized","generalizedTiles","getStyles","gmxWorker"],"mappings":"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"}
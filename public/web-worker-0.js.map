{"version":3,"file":"index.js","sources":["src/worker/Requests.js","src/worker/TilesLoader.js","src/worker/Renderer2d.js","src/worker/DataSourceVersion.js","src/worker/index.js"],"sourcesContent":["\r\nconst\t_self = self || window;\r\n\t\t// serverBase = _self.serverBase || 'maps.kosmosnimki.ru/',\r\n\t\t// serverProxy = serverBase + 'Plugins/ForestReport/proxy',\r\n\t\t// gmxProxy = '//maps.kosmosnimki.ru/ApiSave.ashx';\r\n\r\n// let _app = {},\r\n\t// loaderStatus = {},\r\n\t// _sessionKeys = {},\r\nlet str = _self.location.origin || '',\r\n\t_protocol = str.substring(0, str.indexOf('/')),\r\n\tsyncParams = {},\r\n\tfetchOptions = {\r\n\t\t// method: 'post',\r\n\t\t// headers: {'Content-type': 'application/x-www-form-urlencoded'},\r\n\t\tmode: 'cors',\r\n\t\t// redirect: 'follow',\r\n\t\tcredentials: 'include'\r\n\t};\r\n\r\nconst COMPARS = {WrapStyle: 'None', ftc: 'osm', srs: 3857};\r\n\r\nconst setSyncParams = (hash) => {\t// установка дополнительных параметров для серверных запросов\r\n\tsyncParams = hash;\r\n};\r\nconst getSyncParams = (stringFlag) => {\r\n\tvar res = syncParams;\r\n\tif (stringFlag) {\r\n\t\tvar arr = [];\r\n\t\tfor (var key in res) {\r\n\t\t\tarr.push(key + '=' + res[key]);\r\n\t\t}\r\n\t\tres = arr.join('&');\r\n\t}\r\n\treturn res;\r\n};\r\n\r\nconst parseURLParams = (str) => {\r\n\tlet sp = new URLSearchParams(str || location.search),\r\n\t\tout = {},\r\n\t\tarr = [];\r\n\tfor (let p of sp) {\r\n\t\tlet k = p[0], z = p[1];\r\n\t\tif (z) {\r\n\t\t\tif (!out[k]) {out[k] = [];}\r\n\t\t\tout[k].push(z);\r\n\t\t} else {\r\n\t\t\tarr.push(k);\r\n\t\t}\r\n\t}\r\n\treturn {main: arr, keys: out};\r\n};\r\nlet utils = {\r\n\textend: function (dest) {\r\n\t\tvar i, j, len, src;\r\n\r\n\t\tfor (j = 1, len = arguments.length; j < len; j++) {\r\n\t\t\tsrc = arguments[j];\r\n\t\t\tfor (i in src) {\r\n\t\t\t\tdest[i] = src[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dest;\r\n\t},\r\n\r\n\tmakeTileKeys: function(it, ptiles) {\r\n\t\tvar tklen = it.tilesOrder.length,\r\n\t\t\tarr = it.tiles,\r\n\t\t\ttiles = {},\r\n\t\t\tnewTiles = {};\r\n\r\n\t\twhile (arr.length) {\r\n\t\t\tvar t = arr.splice(0, tklen),\r\n\t\t\t\ttk = t.join('_'),\r\n\t\t\t\ttile = ptiles[tk];\r\n\t\t\tif (!tile || !tile.data) {\r\n\t\t\t\tif (!tile) {\r\n\t\t\t\t\ttiles[tk] = {\r\n\t\t\t\t\t\ttp: {z: t[0], x: t[1], y: t[2], v: t[3], s: t[4], d: t[5]}\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttiles[tk] = tile;\r\n\t\t\t\t}\r\n\t\t\t\tnewTiles[tk] = true;\r\n\t\t\t} else {\r\n\t\t\t\ttiles[tk] = tile;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {tiles: tiles, newTiles: newTiles};\r\n\t},\r\n\r\n\tgetZoomRange: function(info) {\r\n\t\tvar arr = info.properties.styles,\r\n\t\t\tout = [40, 0];\r\n\t\tfor (var i = 0, len = arr.length; i < len; i++) {\r\n\t\t\tvar st = arr[i];\r\n\t\t\tout[0] = Math.min(out[0], st.MinZoom);\r\n\t\t\tout[1] = Math.max(out[1], st.MaxZoom);\r\n\t\t}\r\n\t\tout[0] = out[0] === 40 ? 1 : out[0];\r\n\t\tout[1] = out[1] === 0 ? 22 : out[1];\r\n\t\treturn out;\r\n\t},\r\n\r\n\tchkProtocol: function(url) {\r\n\t\treturn url.substr(0, _protocol.length) === _protocol ? url : _protocol + url;\r\n\t},\r\n\tgetFormBody: function(par) {\r\n\t\treturn Object.keys(par).map(function(key) { return encodeURIComponent(key) + '=' + encodeURIComponent(par[key]); }).join('&');\r\n\t},\r\n\tchkResponse: function(resp, type) {\r\n\t\tif (resp.status < 200 || resp.status >= 300) {\t\t\t\t\t\t// error\r\n\t\t\treturn Promise.reject(resp);\r\n\t\t} else {\r\n\t\t\tvar contentType = resp.headers.get('Content-Type');\r\n\t\t\tif (type === 'bitmap') {\t\t\t\t\t\t\t\t\t\t\t\t// get blob\r\n\t\t\t\treturn resp.blob();\r\n\t\t\t} else if (contentType.indexOf('application/json') > -1) {\t\t\t\t// application/json; charset=utf-8\r\n\t\t\t\treturn resp.json();\r\n\t\t\t} else if (contentType.indexOf('text/javascript') > -1) {\t \t\t\t// text/javascript; charset=utf-8\r\n\t\t\t\treturn resp.text();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.text();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.formData();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.arrayBuffer();\r\n\t\t\t// } else {\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn resp.text();\r\n\t},\r\n\tgetBitMap: function(url) {\r\n\t\tlet options = {type: 'bitmap'};\r\n\t\treturn fetch(url, options)\r\n\t\t.then(function(res) {\r\n\t\t\treturn utils.chkResponse(res, options.type);\r\n\t\t// })\r\n\t\t// .then(function(blob) {\r\n\t\t\t// return createImageBitmap(blob, {\r\n\t\t\t\t// premultiplyAlpha: 'none',\r\n\t\t\t\t// colorSpaceConversion: 'none'\r\n\t\t\t// });\r\n\t\t});\r\n\t},\r\n\tgetTileJson: function(queue) {\r\n\t\tlet params = queue.params || {};\r\n\t\tif (queue.paramsArr) {\r\n\t\t\tqueue.paramsArr.forEach((it) => {\r\n\t\t\t\tparams = utils.extend(params, it);\r\n\t\t\t});\r\n\t\t}\r\n\t\tlet par = utils.extend({}, fetchOptions, COMPARS, params, syncParams),\r\n\t\t\toptions = queue.options || {};\r\n\t\treturn fetch(queue.url + '?' + utils.getFormBody(par))\r\n\t\t.then(function(res) {\r\n\t\t\treturn utils.chkResponse(res, options.type);\r\n\t\t});\r\n\t},\r\n\tgetJson: function(queue) {\r\n\t\tlet params = queue.params || {};\r\n\t\tif (queue.paramsArr) {\r\n\t\t\tqueue.paramsArr.forEach((it) => {\r\n\t\t\t\tparams = utils.extend(params, it);\r\n\t\t\t});\r\n\t\t}\r\n\t\tlet par = utils.extend({}, params, syncParams),\r\n\t\t\toptions = queue.options || {},\r\n\t\t\topt = utils.extend({\r\n\t\t\t\tmethod: 'post',\r\n\t\t\t\theaders: {'Content-type': 'application/x-www-form-urlencoded'}\r\n\t\t\t}, fetchOptions, options, {\r\n\t\t\t\tbody: utils.getFormBody(par)\r\n\t\t\t});\r\n\t\treturn fetch(utils.chkProtocol(queue.url), opt)\r\n\t\t.then(function(res) {\r\n\t\t\treturn utils.chkResponse(res, options.type);\r\n\t\t})\r\n\t\t.then(function(res) {\r\n\t\t\treturn {url: queue.url, queue: queue, load: true, res: res};\r\n\t\t})\r\n\t\t.catch(function(err) {\r\n\t\t\treturn {url: queue.url, queue: queue, load: false, error: err.toString()};\r\n\t\t\t// handler.workerContext.postMessage(out);\r\n\t\t});\r\n    },\r\n\r\n\tgeoItemBounds: function(geo) {  // get item bounds array by geometry\r\n        if (!geo) {\r\n            return {\r\n                bounds: null,\r\n                boundsArr: []\r\n            };\r\n        }\r\n        var type = geo.type,\r\n            coords = geo.coordinates,\r\n            b = null,\r\n            i = 0,\r\n            len = 0,\r\n            bounds = null,\r\n            boundsArr = [];\r\n        if (type === 'MULTIPOLYGON' || type === 'MultiPolygon') {\r\n            bounds = new Bounds();\r\n            for (i = 0, len = coords.length; i < len; i++) {\r\n                var arr1 = [];\r\n                for (var j = 0, len1 = coords[i].length; j < len1; j++) {\r\n                    b = new Bounds(coords[i][j]);\r\n                    arr1.push(b);\r\n                    if (j === 0) { bounds.extendBounds(b); }\r\n                }\r\n                boundsArr.push(arr1);\r\n            }\r\n        } else if (type === 'POLYGON' || type === 'Polygon') {\r\n            bounds = new Bounds();\r\n            for (i = 0, len = coords.length; i < len; i++) {\r\n                b = new Bounds(coords[i]);\r\n                boundsArr.push(b);\r\n                if (i === 0) { bounds.extendBounds(b); }\r\n            }\r\n        } else if (type === 'POINT' || type === 'Point') {\r\n            bounds = new Bounds([coords]);\r\n        } else if (type === 'MULTIPOINT' || type === 'MultiPoint') {\r\n            bounds = new Bounds();\r\n            for (i = 0, len = coords.length; i < len; i++) {\r\n                b = new Bounds([coords[i]]);\r\n                bounds.extendBounds(b);\r\n            }\r\n        } else if (type === 'LINESTRING' || type === 'LineString') {\r\n            bounds = new Bounds(coords);\r\n            //boundsArr.push(bounds);\r\n        } else if (type === 'MULTILINESTRING' || type === 'MultiLineString') {\r\n            bounds = new Bounds();\r\n            for (i = 0, len = coords.length; i < len; i++) {\r\n                b = new Bounds(coords[i]);\r\n                bounds.extendBounds(b);\r\n                //boundsArr.push(b);\r\n            }\r\n        }\r\n        return {\r\n            bounds: bounds,\r\n            boundsArr: boundsArr\r\n        };\r\n    }\r\n\r\n};\r\n/*\r\nconst requestSessionKey = (serverHost, apiKey) => {\r\n\tlet keys = _sessionKeys;\r\n\tif (!(serverHost in keys)) {\r\n\t\tkeys[serverHost] = new Promise(function(resolve, reject) {\r\n\t\t\tif (apiKey) {\r\n\t\t\t\tutils.getJson({\r\n\t\t\t\t\turl: '//' + serverHost + '/ApiKey.ashx',\r\n\t\t\t\t\tparams: {WrapStyle: 'None', Key: apiKey}\r\n\t\t\t\t})\r\n\t\t\t\t\t.then(function(json) {\r\n\t\t\t\t\t\tlet res = json.res;\r\n\t\t\t\t\t\tif (res.Status === 'ok' && res.Result) {\r\n\t\t\t\t\t\t\tresolve(res.Result.Key !== 'null' ? '' : res.Result.Key);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treject(json);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(function() {\r\n\t\t\t\t\t\tresolve('');\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tresolve('');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn keys[serverHost];\r\n};\r\nlet _maps = {};\r\nconst getMapTree = (pars) => {\r\n\tpars = pars || {};\r\n\tlet hostName = pars.hostName || serverBase,\r\n\t\tid = pars.mapId;\r\n\treturn utils.getJson({\r\n\t\turl: '//' + hostName + '/Map/GetMapFolder',\r\n\t\t// options: {},\r\n\t\tparams: {\r\n\t\t\tsrs: 3857, \r\n\t\t\tskipTiles: 'All',\r\n\r\n\t\t\tmapId: id,\r\n\t\t\tfolderId: 'root',\r\n\t\t\tvisibleItemOnly: false\r\n\t\t}\r\n\t})\r\n\t\t.then(function(json) {\r\n\t\t\tlet out = parseTree(json.res);\r\n\t\t\t_maps[hostName] = _maps[hostName] || {};\r\n\t\t\t_maps[hostName][id] = out;\r\n\t\t\treturn parseTree(out);\r\n\t\t});\r\n};\r\nconst getReq = url => {\r\n\treturn fetch(url, {\r\n\t\t\tmethod: 'get',\r\n\t\t\tmode: 'cors',\r\n\t\t\tcredentials: 'include'\r\n\t\t// headers: {'Accept': 'application/json'},\r\n\t\t// body: JSON.stringify(params)\t// TODO: сервер почему то не хочет работать так https://googlechrome.github.io/samples/fetch-api/fetch-post.html\r\n\t\t})\r\n\t\t.then(res => res.json())\r\n\t\t.catch(err => console.warn(err));\r\n};\r\n\r\n// const getLayerItems = (params) => {\r\n\t// params = params || {};\r\n\r\n\t// let url = `${serverBase}VectorLayer/Search.ashx`;\r\n\t// url += '?layer=' + params.layerID;\r\n\t// if (params.id) { '&query=gmx_id=' + params.id; }\r\n\r\n\t// url += '&out_cs=EPSG:4326';\r\n\t// url += '&geometry=true';\r\n\t// return getReq(url);\r\n// };\r\n// const getReportsCount = () => {\r\n\t// return getReq(serverProxy + '?path=/rest/v1/get-current-user-info');\r\n// };\r\n\r\nlet dataSources = {},\r\n\tloaderStatus1 = {};\r\n\r\nconst addDataSource = (pars) => {\r\n\tpars = pars || {};\r\n\r\n\tlet id = pars.id;\r\n\tif (id) {\r\n\t\tlet hostName = pars.hostName;\r\n\t\t\r\n\t} else {\r\n\t\tconsole.warn('Warning: Specify layer \\'id\\' and \\'hostName\\`', pars);\r\n\t}\r\nconsole.log('addDataSource:', pars);\r\n\treturn;\r\n};\r\n\r\nconst removeDataSource = (pars) => {\r\n\tpars = pars || {};\r\n\r\n\tlet id = pars.id;\r\n\tif (id) {\r\n\t\tlet hostName = pars.hostName;\r\n\t\t\r\n\t} else {\r\n\t\tconsole.warn('Warning: Specify layer \\'id\\' and \\'hostName\\`', pars);\r\n\t}\r\nconsole.log('removeDataSource:', pars);\r\n\t//Requests.removeDataSource({id: message.layerID, hostName: message.hostName}).then((json) => {\r\n\treturn;\r\n};\r\nlet _maps = {};\r\nconst getMapTree = (pars) => {\r\n\tpars = pars || {};\r\n\tlet hostName = pars.hostName || 'maps.kosmosnimki.ru',\r\n\t\tid = pars.mapID;\r\n\treturn utils.getJson({\r\n\t\turl: '//' + hostName + '/Map/GetMapFolder',\r\n\t\t// options: {},\r\n\t\tparams: {\r\n\t\t\tsrs: 3857, \r\n\t\t\tskipTiles: 'All',\r\n\r\n\t\t\tmapId: id,\r\n\t\t\tfolderId: 'root',\r\n\t\t\tvisibleItemOnly: false\r\n\t\t}\r\n\t})\r\n\t\t// .then(function(json) {\r\n\t\t\t// let out = parseTree(json.res);\r\n\t\t\t// _maps[hostName] = _maps[hostName] || {};\r\n\t\t\t// _maps[hostName][id] = out;\r\n\t\t\t// return parseTree(out);\r\n\t\t// });\r\n};\r\n\r\nconst _iterateNodeChilds = (node, level, out) => {\r\n\tlevel = level || 0;\r\n\tout = out || {\r\n\t\tlayers: []\r\n\t};\r\n\t\r\n\tif (node) {\r\n\t\tlet type = node.type,\r\n\t\t\tcontent = node.content,\r\n\t\t\tprops = content.properties;\r\n\t\tif (type === 'layer') {\r\n\t\t\tlet ph = utils.parseLayerProps(props);\r\n\t\t\tph.level = level;\r\n\t\t\tif (content.geometry) { ph.geometry = content.geometry; }\r\n\t\t\tout.layers.push(ph);\r\n\t\t} else if (type === 'group') {\r\n\t\t\tlet childs = content.children || [];\r\n\t\t\tout.layers.push({ level: level, group: true, childsLen: childs.length, properties: props });\r\n\t\t\tchilds.map((it) => {\r\n\t\t\t\t_iterateNodeChilds(it, level + 1, out);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t} else {\r\n\t\treturn out;\r\n\t}\r\n\treturn out;\r\n};\r\n\r\nconst parseTree = (json) => {\r\n\tlet out = {};\r\n\tif (json.Status === 'error') {\r\n\t\tout = json;\r\n\t} else if (json.Result && json.Result.content) {\r\n\t\tout = _iterateNodeChilds(json.Result);\r\n\t\tout.mapAttr = out.layers.shift();\r\n\t}\r\n// console.log('______json_out_______', out, json)\r\n\treturn out;\r\n};\r\n*/\r\n\r\nconst chkSignal = (signalName, signals, opt) => {\r\n\topt = opt || {};\r\n\tlet sObj = signals[signalName];\r\n// console.log('sssssss', sObj, signalName)\r\n\tif (sObj) { sObj.abort(); }\r\n\tsObj = signals[signalName] = new AbortController();\r\n\tsObj.signal.addEventListener('abort', (ev) => console.log('Отмена fetch:', ev));\r\n\topt.signal = sObj.signal;\r\n\tsignals[signalName] = sObj;\r\n\treturn opt;\r\n};\r\n\r\nconst Bounds = function(arr) {\r\n    this.min = {\r\n        x: Number.MAX_VALUE,\r\n        y: Number.MAX_VALUE\r\n    };\r\n    this.max = {\r\n        x: -Number.MAX_VALUE,\r\n        y: -Number.MAX_VALUE\r\n    };\r\n    this.extendArray(arr);\r\n};\r\nBounds.prototype = {\r\n    extend: function(x, y) {\r\n        if (x < this.min.x) { this.min.x = x; }\r\n        if (x > this.max.x) { this.max.x = x; }\r\n        if (y < this.min.y) { this.min.y = y; }\r\n        if (y > this.max.y) { this.max.y = y; }\r\n        return this;\r\n    },\r\n    extendBounds: function(bounds) {\r\n        return this.extendArray([[bounds.min.x, bounds.min.y], [bounds.max.x, bounds.max.y]]);\r\n    },\r\n    extendArray: function(arr) {\r\n        if (!arr || !arr.length) { return this; }\r\n        var i, len;\r\n        if (typeof arr[0] === 'number') {\r\n            for (i = 0, len = arr.length; i < len; i += 2) {\r\n                this.extend(arr[i], arr[i + 1]);\r\n            }\r\n        } else {\r\n            for (i = 0, len = arr.length; i < len; i++) {\r\n                this.extend(arr[i][0], arr[i][1]);\r\n            }\r\n        }\r\n        return this;\r\n    },\r\n    addBuffer: function(dxmin, dymin, dxmax, dymax) {\r\n        this.min.x -= dxmin;\r\n        this.min.y -= dymin || dxmin;\r\n        this.max.x += dxmax || dxmin;\r\n        this.max.y += dymax || dymin || dxmin;\r\n        return this;\r\n    },\r\n    contains: function (point) { // ([x, y]) -> Boolean\r\n        var min = this.min, max = this.max,\r\n            x = point[0], y = point[1];\r\n        return x >= min.x && x <= max.x && y >= min.y && y <= max.y;\r\n    },\r\n    getCenter: function () {\r\n        var min = this.min, max = this.max;\r\n        return [(min.x + max.x) / 2, (min.y + max.y) / 2];\r\n    },\r\n    addOffset: function (offset) {\r\n        this.min.x += offset[0]; this.max.x += offset[0];\r\n        this.min.y += offset[1]; this.max.y += offset[1];\r\n        return this;\r\n    },\r\n    intersects: function (bounds) { // (Bounds) -> Boolean\r\n        var min = this.min,\r\n            max = this.max,\r\n            min2 = bounds.min,\r\n            max2 = bounds.max;\r\n        return max2.x > min.x && min2.x < max.x && max2.y > min.y && min2.y < max.y;\r\n    },\r\n    intersectsWithDelta: function (bounds, dx, dy) { // (Bounds, dx, dy) -> Boolean\r\n        var min = this.min,\r\n            max = this.max,\r\n            x = dx || 0,\r\n            y = dy || 0,\r\n            min2 = bounds.min,\r\n            max2 = bounds.max;\r\n        return max2.x + x > min.x && min2.x - x < max.x && max2.y + y > min.y && min2.y - y < max.y;\r\n    },\r\n    isEqual: function (bounds) { // (Bounds) -> Boolean\r\n        var min = this.min,\r\n            max = this.max,\r\n            min2 = bounds.min,\r\n            max2 = bounds.max;\r\n        return max2.x === max.x && min2.x === min.x && max2.y === max.y && min2.y === min.y;\r\n    },\r\n    isNodeIntersect: function (coords) {\r\n        for (var i = 0, len = coords.length; i < len; i++) {\r\n            if (this.contains(coords[i])) {\r\n                return {\r\n                    num: i,\r\n                    point: coords[i]\r\n                };\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n};\r\n\r\n    // bounds: function(arr) {\r\n\t\t// return new Bounds(arr);\r\n    // },\r\n\r\nexport default {\r\n\tbounds: arr => new Bounds(arr),\r\n\tgeoItemBounds: utils.geoItemBounds,\r\n\tchkSignal,\r\n\tCOMPARS,\r\n\tsetSyncParams,\r\n\tgetSyncParams,\r\n\tparseURLParams,\r\n\t// getMapTree,\r\n\textend: utils.extend,\r\n\tgetBitMap: utils.getBitMap,\r\n\tgetFormBody: utils.getFormBody,\r\n\tgetTileJson: utils.getTileJson,\r\n\tgetJson: utils.getJson\r\n\t// addDataSource,\r\n\t// removeDataSource,\r\n\t// getReportsCount,\r\n\t// getLayerItems\r\n};","import Requests from './Requests';\r\n\r\nconst TILE_PREFIX = 'gmxAPI._vectorTileReceiver(';\r\n\r\nconst load = (pars) => {\r\n\tpars = pars || {};\r\n\tif (!pars.signals) { pars.signals = {}; }\r\n\tif (!pars.tilesPromise) { pars.tilesPromise = {}; }\r\n\t\r\n\t// return new Promise((resolve) => {\r\n\t\tlet tilesOrder = pars.tilesOrder,\r\n\t\t\tpb = pars.tiles,\r\n\t\t\ttilesPromise = {};\r\n\t\tfor (let i = 0, len = pb.length; i < len; i += tilesOrder.length) {\r\n\t\t\tlet arr = pb.slice(i, i + tilesOrder.length),\r\n\t\t\t\ttkey = arr.join('_'),\r\n\t\t\t\ttHash = tilesOrder.reduce((p, c, j) => { p[c] = arr[j]; return p; }, {});\r\n\r\n\t\t\tif (pars.tilesPromise[tkey]) {\r\n\t\t\t\ttilesPromise[tkey] = pars.tilesPromise[tkey];\r\n\t\t\t} else {\r\n\t\t\t\t// pars.tilesPromise[tkey] = Requests.getTileJson({\r\n\t\t\t\ttilesPromise[tkey] = Requests.getTileJson({\r\n\t\t\t\t\turl: '//' + pars.hostName + '/TileSender.ashx',\r\n\t\t\t\t\toptions: Requests.chkSignal(tkey, pars.signals),\r\n\t\t\t\t\tparamsArr: [tHash, {\r\n\t\t\t\t\t\tr: 'j',\r\n\t\t\t\t\t\tModeKey: 'tile',\r\n\t\t\t\t\t\tLayerName: pars.id,\r\n\t\t\t\t\t}]\r\n\t\t\t\t}).then(json => {\r\n\t\t\t\t\tdelete pars.signals[tkey];\r\n\t\t\t\t\tif (typeof(json) === 'string') {\r\n\t\t\t\t\t\tif (json.substr(0, TILE_PREFIX.length) === TILE_PREFIX) {\r\n\t\t\t\t\t\t\tjson = json.replace(TILE_PREFIX, '');\r\n\t\t\t\t\t\t\tjson = JSON.parse(json.substr(0, json.length -1));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tjson.bounds = Requests.bounds(json.bbox);\r\n\t\t\t\t\treturn json;\r\n\t\t\t\t})\r\n\t\t\t\t.catch(err => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\tObject.keys(pars.signals).forEach(k => {\r\n\t\t\tif (!tilesPromise[k]) {\r\n\t\t\t\tpars.signals[k].abort();\r\n\t\t\t\tdelete pars.signals[k];\r\n\t\t\t}\r\n\t\t});\r\n\t\tpars.tilesPromise = tilesPromise;\r\n\t\t// return out;\r\n\t\t// Promise.all(arr).then((out) => {\r\n\t\t\t// resolve(out);\r\n\t\t// });\r\n\t// });\r\n};\r\n\r\nexport default {\r\n\tload\r\n};","\n// const HOST = 'maps.kosmosnimki.ru';\n\n// let hosts = {},\n\t// zoom = 3,\n\t// bbox = null,\n\t// dataManagersLinks = {},\n\t// hostBusy = {},\n\t// needReq = {}\n\t// delay = 60000,\n\t// intervalID = null,\n\t// timeoutID = null;\n\n// ph = {\n\t// ctx: - 2d canvas контекст\n\t// bounds: - bounds операции\n\t// w: - canvas.width\n\t// h: - canvas.height\n\t// canvas: - canvas\n// }\nconst _reqParse = (ph) => {\n\tph = ph || {};\n\tif (ph.canvas) {\n\t\tph._ctx = ph._ctx || ph.canvas.getContext('2d');\n\t\tph.w = ph.w || ph.canvas.width;\n\t\tph.h = ph.h || ph.canvas.height;\n\t}\n\treturn ph;\n};\n\nconst utils = {\n\t_clear: function (ph) {\n\t\tph = _reqParse(ph);\n\t\tif (ph.bounds) {\n\t\t\tlet size = ph.bounds.getSize();\n\t\t\tph._ctx.clearRect(ph.bounds.min.x, ph.bounds.min.y, size.x, size.y);\n\t\t} else {\n\t\t\tph._ctx.save();\n\t\t\tph._ctx.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\tph._ctx.clearRect(0, 0, ph.w, ph.h);\n\t\t\tph._ctx.restore();\n\t\t}\n\t},\n\n\t_draw: function (ph) {\n\t\tph = _reqParse(ph);\n\t\t// var layer, bounds = this._redrawBounds;\n\t\tph._ctx.save();\n\t\tif (ph.bounds) {\n\t\t\tlet size = ph.bounds.getSize();\n\t\t\tph._ctx.beginPath();\n\t\t\tph._ctx.rect(ph.bounds.min.x, ph.bounds.min.y, size.x, size.y);\n\t\t\tph._ctx.clip();\n\t\t}\n\n\t\tph._drawing = true;\n\n\t\tfor (let order = ph._drawFirst; order; order = order.next) {\n\t\t\tlet layer = order.layer;\n\t\t\tif (!ph.bounds || (layer._pxBounds && layer._pxBounds.intersects(ph.bounds))) {\n\t\t\t\t// layer._updatePath();\n\t\t\t}\n\t\t}\n\n\t\tph._drawing = false;\n\n\t\tph._ctx.restore();  // Restore state before clipping.\n\t},\n\n\t_updatePoly: function (ph) {\n\t// _updatePoly: function (layer, closed) {\n\t\tph = _reqParse(ph);\n\t\tif (!ph._drawing) { return; }\n\n\t\tlet i, j, len2, p,\n\t\t\t// coords = ph.coords,\n\t\t\tparts = ph.itemData.pixels || ph._parts,\n\t\t\tlen = parts.length,\n\t\t\tctx = ph._ctx;\n\n\t\tif (!len) { return; }\n\n\t\tctx.beginPath();\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tfor (j = 0, len2 = parts[i].length; j < len2; j+=2) {\n\t\t\t\t//p = parts[i][j];\n\t\t\t\tctx[j ? 'lineTo' : 'moveTo'](parts[i][j], parts[i][j + 1]);\n\t\t\t}\n\t\t\t// for (j = 0, len2 = parts[i].length; j < len2; j++) {\n\t\t\t\t// p = parts[i][j];\n\t\t\t\t// ctx[j ? 'lineTo' : 'moveTo'](p.x, p.y);\n\t\t\t// }\n\t\t\tif (ph.closed) {\n\t\t\t\tctx.closePath();\n\t\t\t}\n\t\t}\n// ctx.strokeText(coords.z + '.' + coords.x + '.' + coords.y, 150, 150);\n\n\n\t\tutils._fillStroke(ph);\n\n\t\t// TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature\n\t},\n\n\t_updatePolyMerc: function (ph) {\n\t// _updatePoly: function (layer, closed) {\n\t\tph = _reqParse(ph);\n\t\tif (!ph._drawing) { return; }\n\n\t\tlet i, j, len2, p,\n\t\t\t// coords = ph.coords,\n\t\t\tparts = ph.itemData.pixels || ph._parts,\n\t\t\tmInPixel = ph.mInPixel,\n\t\t\titem = ph.itemData.item,\n\t\t\tcoordinates = item[item.length - 1].coordinates,\n\t\t\tlen = coordinates.length,\n\t\t\tctx = ph._ctx;\n\n\t\tif (!len) { return; }\n\n\t\t// ctx.translate(ph.tpx * mInPixel, ph.tpy * mInPixel);\n\t\tctx.translate(ph.tpx, ph.tpy);\n\t\tctx.scale(mInPixel, mInPixel);\n\t\tctx.beginPath();\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tfor (j = 0, len2 = coordinates[i].length; j < len2; j++) {\n\t\t\t\tp = coordinates[i][j];\n\t\t\t\tctx[j ? 'lineTo' : 'moveTo'](p[0], p[1]);\n\t\t\t}\n\t\t\t// for (j = 0, len2 = parts[i].length; j < len2; j++) {\n\t\t\t\t// p = parts[i][j];\n\t\t\t\t// ctx[j ? 'lineTo' : 'moveTo'](p.x, p.y);\n\t\t\t// }\n\t\t\tif (ph.closed) {\n\t\t\t\tctx.closePath();\n\t\t\t}\n\t\t}\n// ctx.strokeText(coords.z + '.' + coords.x + '.' + coords.y, 150, 150);\n\n\n\t\tutils._fillStroke(ph);\n\n\t\t// TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature\n\t},\n\n\n\t_updateCircle: function (ph) {\n\t// _updateCircle: function (layer) {\n\t\tph = _reqParse(ph);\n\n\t\tif (!ph._drawing || !ph._point) { return; }\n\n\t\tlet p = ph._point,\n\t\t\tctx = ph._ctx,\n\t\t\tr = Math.max(Math.round(ph._radius), 1),\n\t\t\ts = (Math.max(Math.round(ph._radiusY), 1) || r) / r;\n\n\t\tif (s !== 1) {\n\t\t\tctx.save();\n\t\t\tctx.scale(1, s);\n\t\t}\n\n\t\tctx.beginPath();\n\t\tctx.arc(p.x, p.y / s, r, 0, Math.PI * 2, false);\n\n\t\tif (s !== 1) {\n\t\t\tctx.restore();\n\t\t}\n\n\t\tutils._fillStroke(ph);\n\t},\n\n\t_fillStroke: function (ph) {\n\t// _fillStroke: function (ctx, layer) {\n\t\tph = _reqParse(ph);\n\t\tlet options = ph.options,\n\t\t\tctx = ph._ctx;\n\n\t\tif (options.fill) {\n\t\t\tctx.globalAlpha = options.fillOpacity;\n\t\t\tctx.fillStyle = options.fillColor || options.color;\n\t\t\tctx.fill(options.fillRule || 'evenodd');\n\t\t}\n\n\t\tif (options.stroke && options.weight !== 0) {\n\t\t\tif (ctx.setLineDash) {\n\t\t\t\tctx.setLineDash(options && options._dashArray || []);\n\t\t\t}\n\t\t\tctx.globalAlpha = options.opacity;\n\t\t\tctx.lineWidth = options.weight;\n\t\t\tctx.strokeStyle = options.color;\n\t\t\tctx.lineCap = options.lineCap;\n\t\t\tctx.lineJoin = options.lineJoin;\n\t\t\tctx.stroke();\n\t\t}\n\t}\n}\n\nexport default {\n\tdraw: utils._draw,\n\tupdatePolyMerc: utils._updatePolyMerc,\n\tupdatePoly: utils._updatePoly,\n\tupdateCircle: utils._updateCircle,\n\tfillStroke: utils._fillStroke,\n\tclear: utils._clear\n};","import Requests from './Requests';\nimport TilesLoader from './TilesLoader';\nimport Renderer2d from './Renderer2d';\n\nconst HOST = 'maps.kosmosnimki.ru',\n    WORLDWIDTHFULL = 40075016.685578496,\n\tW = WORLDWIDTHFULL / 2,\n\tWORLDBBOX = [[-W, -W, W, W]],\n    SCRIPT = '/Layer/CheckVersion.ashx',\n\tGMXPROXY = '//maps.kosmosnimki.ru/ApiSave.ashx',\n\tMINZOOM = 1,\n\tMAXZOOM = 22,\n    STYLEKEYS = {\n        marker: {\n            server: ['image',   'angle',     'scale',     'minScale',     'maxScale',     'size',         'circle',     'center',     'color'],\n            client: ['iconUrl', 'iconAngle', 'iconScale', 'iconMinScale', 'iconMaxScale', 'iconSize', 'iconCircle', 'iconCenter', 'iconColor']\n        },\n        outline: {\n            server: ['color',  'opacity',   'thickness', 'dashes'],\n            client: ['color',  'opacity',   'weight',    'dashArray']\n        },\n        fill: {\n            server: ['color',     'opacity',   'image',       'pattern',     'radialGradient',     'linearGradient'],\n            client: ['fillColor', 'fillOpacity', 'fillIconUrl', 'fillPattern', 'fillRadialGradient', 'fillLinearGradient']\n        },\n        label: {\n            server: ['text',      'field',      'template',      'color',      'haloColor',      'size',          'spacing',      'align'],\n            client: ['labelText', 'labelField', 'labelTemplate', 'labelColor', 'labelHaloColor', 'labelFontSize', 'labelSpacing', 'labelAlign']\n        }\n    },\n    STYLEFUNCKEYS = {\n        // iconUrl: 'iconUrlFunction',\n        iconSize: 'iconSizeFunction',\n        iconAngle: 'rotateFunction',\n        iconScale: 'scaleFunction',\n        iconColor: 'iconColorFunction',\n        opacity: 'opacityFunction',\n        fillOpacity: 'fillOpacityFunction',\n        color: 'colorFunction',\n        fillColor: 'fillColorFunction'\n/*\n    },\n\n    STYLEFUNCERROR = {\n        // iconUrl: function() { return ''; },\n        iconSize: function() { return 8; },\n        iconAngle: function() { return 0; },\n        iconScale: function() { return 1; },\n        iconColor: function() { return 0xFF; },\n        opacity: function() { return 1; },\n        fillOpacity: function() { return 0.5; },\n        color: function() { return 0xFF; },\n        fillColor: function() { return 0xFF; }\n    },\n    DEFAULTSTYLES = {\n       MinZoom: 1,\n       MaxZoom: 21,\n       Filter: '',\n       Balloon: '',\n       DisableBalloonOnMouseMove: true,\n       DisableBalloonOnClick: false,\n       RenderStyle: {\n            point: {    // old = {outline: {color: 255, thickness: 1}, marker:{size: 8}},\n                color: 0xFF,\n                weight: 1,\n                iconSize: 8\n            },\n            linestring: {    // old = {outline: {color: 255, thickness: 1}},\n                color: 0xFF,\n                weight: 1\n            },\n            polygon: {    // old = {outline: {color: 255, thickness: 1}},\n                color: 0xFF,\n                weight: 1\n            }\n        }\n*/\n    };\n\nlet hosts = {},\n    zoom = 3,\n    bbox = null,\n\t// dataManagersLinks = {},\n    // hostBusy = {},\n    // needReq = {}\n    delay = 60000,\n\tintervalID = null,\n    timeoutID = null;\n\n\nconst utils = {\n    getCoordsPixels: function(attr) {\n        var coords = attr.coords,\n            z = attr.z,\n\t\t\ttpx = attr.tpx,\n\t\t\ttpy = attr.tpy,\n            hiddenLines = attr.hiddenLines || [],\n            pixels = [],\n            hidden = [],\n            hiddenFlag = false,\n            mInPixel = Math.pow(2, z + 8) / WORLDWIDTHFULL;\n\t\t\t/*\n\t\t\t,\n            hash = {\n                // gmx: gmx,\n\t\t\t\t// topLeft: attr.topLeft,\n                tpx: tpx,\n                tpy: tpy,\n                coords: null,\n                hiddenLines: null\n            };\n\t\t\t*/\n        for (var j = 0, len = coords.length; j < len; j++) {\n            // var coords1 = coords[j],\n                // hiddenLines1 = hiddenLines[j] || [],\n                // pixels1 = [], hidden1 = [];\n\t\t\tcoords[j].forEach(ringMerc => {\n                var res = utils.getRingPixels({\n\t\t\t\t\tringMerc: ringMerc,\n\t\t\t\t\ttpx: tpx,\n\t\t\t\t\ttpy: tpy,\n\t\t\t\t\tmInPixel: mInPixel,\n\t\t\t\t\thiddenLines: hiddenLines\n\t\t\t\t});\n\t\t\t\tpixels.push(res.pixels);\n\t\t\t\t// var tt = res;\n\t\t\t});\n\t\t\t/*\n            for (var j1 = 0, len1 = coords1.length; j1 < len1; j1++) {\n                hash.ringMerc = coords1[j1];\n                hash.hiddenLines = hiddenLines1[j1] || [];\n                var res = utils.getRingPixels(hash);\n                pixels1.push(res.coords);\n                hidden1.push(res.hidden);\n                if (res.hidden) {\n                    hiddenFlag = true;\n                }\n            }\n            pixels.push(pixels1);\n            hidden.push(hidden1);\n\t\t\t*/\n        }\nconsole.log('aaaaaaaaaa', pixels, tpx, tpy)\n\t\t\n        return {coords: pixels, hidden: hiddenFlag ? hidden : null, z: z};\n    },\n\n    getRingPixels: ({ringMerc, tpx, tpy, mInPixel, hiddenLines}) => {\nconsole.log('getRingPixels', ringMerc, tpx, tpy)\n        if (ringMerc.length === 0) {\n\t\t\treturn null;\n\t\t}\n        var cnt = 0, cntHide = 0,\n            lastX = null, lastY = null,\n            vectorSize = typeof ringMerc[0] === 'number' ? 2 : 1,\n            pixels = [], hidden = [];\n        for (var i = 0, len = ringMerc.length; i < len; i += vectorSize) {\n            var lineIsOnEdge = false;\n            if (hiddenLines && i === hiddenLines[cntHide]) {\n                lineIsOnEdge = true;\n                cntHide++;\n            }\n            var c = vectorSize === 1 ? ringMerc[i] : [ringMerc[i], ringMerc[i + 1]],\n                x1 = Math.round((c[0] + W) * mInPixel), y1 = Math.round((W - c[1]) * mInPixel),\n                x2 = Math.round(x1 - tpx), y2 = Math.round(y1 - tpy);\n\n            if (lastX !== x2 || lastY !== y2) {\n                lastX = x2; lastY = y2;\n                if (lineIsOnEdge) {\n                    hidden.push(cnt);\n                }\n                pixels[cnt++] = x2;\n                pixels[cnt++] = y2;\n            }\n        }\n        return {pixels: pixels, hidden: hidden.length ? hidden : null};\n    },\n    \n\tnow: function() {\n\t\tif (timeoutID) { clearTimeout(timeoutID); }\n\t\ttimeoutID = setTimeout(chkVersion, 0);\n    },\n\n    stop: function() {\n\t\tconsole.log('stop:', intervalID, delay);\n        if (intervalID) { clearInterval(intervalID); }\n        intervalID = null;\n    },\n\n    start: function(msec) {\n\t\tconsole.log('start:', intervalID, msec);\n        if (msec) { delay = msec; }\n        utils.stop();\n        intervalID = setInterval(chkVersion, delay);\n    },\n/*\n    parseLayerProps: function(prop) {\n\t\t// let ph = utils.getTileAttributes(prop);\n\t\treturn Requests.extend(\n\t\t\t{\n\t\t\t\tproperties: prop\n\t\t\t},\n\t\t\tutils.getTileAttributes(prop),\n\t\t\tutils.parseStyles(prop),\n\t\t\tutils.parseMetaProps(prop)\n\t\t);\n    },\n*/\n    parseFilter: function(str) {\n\t\tlet regex1 = /\"(.+?)\" in \\((.+?)\\)/g,\n\t\t\tregex2 = /\"(.+?)\"/g,\n\t\t\tregexMath = /(floor\\()/g,\n\t\t\tbody = str ? str\n\t\t\t\t.replace(/[[\\]]/g, '\"')\n\t\t\t\t.replace(regex1, '[$2].includes(props[indexes[\\'$1\\']])')\n\t\t\t\t.replace(regex2, 'props[indexes[\\'$1\\']]')\n\t\t\t\t.replace(/=/g, '===')\n\t\t\t\t.replace(/\\bAND\\b/g, '&&')\n\t\t\t\t.replace(/\\bOR\\b/g, '||')\n\t\t\t\t.replace(regexMath, 'Math.$1')\n\t\t\t\t: true;\n\t\treturn {\n\t\t\tfilter: str,\n\t\t\tfilterParsed: body,\n\t\t\tfilterFun: new Function('props', 'indexes', 'return ' + body + ';')\n\t\t};\n    },\n\n// StyleManager.decodeOldStyles = function(props) {\n    // var styles = props.styles,\n\t\t// arr = styles || [{MinZoom: 1, MaxZoom: 21, RenderStyle: StyleManager.DEFAULT_STYLE}],\n\t\t// type = props.type.toLocaleLowerCase(),\n\t\t// gmxStyles = {\n\t\t\t// attrKeys: {},\n\t\t\t// iconsUrl: {}\n\t\t// };\n\t// gmxStyles.styles = arr.map(function(it) {\n        // var pt = {\n            // Name: it.Name || '',\n            // type: type || '',\n\t\t\t// legend: false,\n            // MinZoom: it.MinZoom || 0,\n            // MaxZoom: it.MaxZoom || 18\n        // };\n\t\t// pt.labelMinZoom = it.labelMinZoom || pt.MinZoom;\n\t\t// pt.labelMaxZoom = it.labelMaxZoom || pt.MaxZoom;\n\n        // if ('Balloon' in it) {\n            // pt.Balloon = it.Balloon;\n\t\t\t// var hash = StyleManager.getKeysHash(it.Balloon, 'Balloon');\n\t\t\t// if (Object.keys(hash).length) {\n\t\t\t\t// L.extend(gmxStyles.attrKeys, hash);\n\t\t\t// }\n        // }\n        // if (it.RenderStyle) {\n            // var rt = StyleManager.decodeOldStyle(it.RenderStyle);\n\t\t\t// L.extend(gmxStyles.attrKeys, rt.attrKeys);\n\t\t\t// if (rt.style.iconUrl) { gmxStyles.iconsUrl[rt.style.iconUrl] = true; }\n            // pt.RenderStyle = rt.style;\n\t\t\t// if (it.HoverStyle === undefined) {\n\t\t\t\t// var hoveredStyle = JSON.parse(JSON.stringify(pt.RenderStyle));\n\t\t\t\t// if (hoveredStyle.outline) { hoveredStyle.outline.thickness += 1; }\n\t\t\t\t// pt.HoverStyle = hoveredStyle;\n\t\t\t// } else if (it.HoverStyle === null) {\n\t\t\t\t// delete pt.HoverStyle;\n\t\t\t// } else {\n\t\t\t\t// var ht = StyleManager.decodeOldStyle(it.HoverStyle);\n\t\t\t\t// pt.HoverStyle = ht.style;\n\t\t\t// }\n        // } else if (type === 'vector ') {\n            // pt.RenderStyle = StyleManager.DEFAULT_STYLE;\n\t\t// }\n\n        // if ('DisableBalloonOnMouseMove' in it) {\n            // pt.DisableBalloonOnMouseMove = it.DisableBalloonOnMouseMove === false ? false : true;\n        // }\n        // if ('DisableBalloonOnClick' in it) {\n            // pt.DisableBalloonOnClick = it.DisableBalloonOnClick || false;\n        // }\n        // if ('Filter' in it) {\t// TODO: переделать на new Function = function(props, indexes, types)\n// /*eslint-disable no-useless-escape */\n            // pt.Filter = it.Filter;\n            // var ph = L.gmx.Parsers.parseSQL(it.Filter.replace(/[\\[\\]]/g, '\"'));\n// /*eslint-enable */\n\t\t\t// TODO: need body for function ƒ (props, indexes, types)\n            // if (ph) { pt.filterFunction = ph; }\n        // }\n\t\t// return pt;\n\t// });\n    // return gmxStyles;\n// };\n\n\tdecodeOldStyle: function(style) {   // Style Scanex->leaflet\n\t\tlet st, i, len, key, key1,\n\t\t\tstyleOut = {};\n\t\t\t// attrKeys = {},\n\t\t\t// type = '';\n\n\t\tfor (key in STYLEKEYS) {\n\t\t\tlet keys = STYLEKEYS[key];\n\t\t\tfor (i = 0, len = keys.client.length; i < len; i++) {\n\t\t\t\tkey1 = keys.client[i];\n\t\t\t\tif (key1 in style) {\n\t\t\t\t\tstyleOut[key1] = style[key1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tst = style[key];\n\t\t\tif (st && typeof (st) === 'object') {\n\t\t\t\tfor (i = 0, len = keys.server.length; i < len; i++) {\n\t\t\t\t\tkey1 = keys.server[i];\n\t\t\t\t\tif (key1 in st) {\n\t\t\t\t\t\tvar newKey = keys.client[i],\n\t\t\t\t\t\t\tzn = st[key1];\n\t\t\t\t\t\tif (typeof (zn) === 'string') {\n\t\t\t\t\t\t\t// var hash = StyleManager.getKeysHash(zn, newKey);\n\t\t\t\t\t\t\t// if (Object.keys(hash).length) {\n\t\t\t\t\t\t\t\t// styleOut.common = false;\n\t\t\t\t\t\t\t\t// L.extend(attrKeys, hash);\n\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\tif (STYLEFUNCKEYS[newKey]) {\n\t\t\t\t\t\t\t\t// if (zn.match(/[^\\d\\.]/) === null) {\n\t\t\t\t\t\t\t\t\t// zn = Number(zn);\n\t\t\t\t\t\t\t\t// } else {\n\t\t\t\t\t\t\t\t\t//var func = L.gmx.Parsers.parseExpression(zn);\n\t\t\t\t\t\t\t\t\t// if (func === null) {\n\t\t\t\t\t\t\t\t\t\t// zn = STYLEFUNCERROR[newKey]();\n\t\t\t\t\t\t\t\t\t// } else {\n\t\t\t\t\t\t\t\t\t\t// styleOut[STYLEFUNCKEYS[newKey]] = func;\n\t\t\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (key1 === 'opacity') {\n\t\t\t\t\t\t\tzn /= 100;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstyleOut[newKey] = zn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (style.marker) {\n\t\t\tst = style.marker;\n\t\t\tif ('dx' in st || 'dy' in st) {\n\t\t\t\tvar dx = st.dx || 0,\n\t\t\t\t\tdy = st.dy || 0;\n\t\t\t\tstyleOut.iconAnchor = [-dx, -dy];    // For leaflet type iconAnchor\n\t\t\t}\n\t\t}\n\t\tfor (key in style) {\n\t\t\tif (!STYLEKEYS[key]) {\n\t\t\t\tstyleOut[key] = style[key];\n\t\t\t}\n\t\t}\n\t\treturn styleOut;\n/*\n\t\treturn {\n\t\t\tstyle: styleOut,\t\t\t// стиль\n\t\t\t// attrKeys: attrKeys,\t\t\t// используемые поля атрибутов\n\t\t\ttype: type\t\t\t\t\t// 'polygon', 'line', 'circle', 'square', 'image'\n\t\t};\n*/\n\t},\n    getTileBounds: function(coords) {\n\t\tvar tileSize = WORLDWIDTHFULL / Math.pow(2, coords.z),\n            minx = coords.x * tileSize - W,\n            miny = W - coords.y * tileSize;\n        return Requests.bounds([[minx, miny], [minx + tileSize, miny + tileSize]]);\n    },\n\n    // getTileNumFromLeaflet: function (tilePoint, zoom) {\n        // if ('z' in tilePoint) {\n            // zoom = tilePoint.z;\n        // }\n        // var pz = Math.pow(2, zoom),\n            // tx = tilePoint.x % pz + (tilePoint.x < 0 ? pz : 0),\n            // ty = tilePoint.y % pz + (tilePoint.y < 0 ? pz : 0);\n        // return {\n            // z: zoom,\n            // x: tx % pz - pz / 2,\n            // y: pz / 2 - 1 - ty % pz\n        // };\n    // },\n\n    _getMaxStyleSize: function(zoom, styles) {  // estimete style size for arbitrary object\n        var maxSize = 0;\n        for (var i = 0, len = styles.length; i < len; i++) {\n            var style = styles[i];\n            if (zoom > style.MaxZoom || zoom < style.MinZoom) { continue; }\n            var RenderStyle = style.RenderStyle;\n            if (this._needLoadIcons || !RenderStyle || !('maxSize' in RenderStyle)) {\n                maxSize = 128;\n                break;\n            }\n            var maxShift = 0;\n            if ('iconAnchor' in RenderStyle && !RenderStyle.iconCenter) {\n                maxShift = Math.max(\n                    Math.abs(RenderStyle.iconAnchor[0]),\n                    Math.abs(RenderStyle.iconAnchor[1])\n                );\n            }\n            maxSize = Math.max(RenderStyle.maxSize + maxShift, maxSize);\n        }\n        return maxSize;\n    },\n\n    parseStyles: (prop) => {\n        let styles = prop.styles || [];\n\t\t\t// attr = prop.tileAttributeIndexes,\n\t\t// prop._maxStyleSize = 128;\n\t\tprop._maxStyleSize = 0;\n\t\tlet out = styles.map(it => {\n\t\t\t\treturn new Promise(resolve => {\n\t\t\t\t\tlet data = utils.parseFilter(it.Filter || ''),\n\t\t\t\t\t\trenderStyle = it.RenderStyle,\n\t\t\t\t\t\ticonUrl = renderStyle.iconUrl || (renderStyle.marker && renderStyle.marker.image);\n\t\t\t\t\tdata.MinZoom = it.MinZoom || MINZOOM;\n\t\t\t\t\tdata.MaxZoom = it.MaxZoom || MAXZOOM;\n\t\t\t\t\tif (renderStyle) {\n\t\t\t\t\t\tdata.renderStyle = utils.decodeOldStyle(renderStyle);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (iconUrl) {\n\t\t\t\t\t\tRequests.getBitMap(iconUrl).then(blob => {\n\t\t// .then(function(blob) {\n\t\t\t// return createImageBitmap(blob, {\n\t\t\t\t// premultiplyAlpha: 'none',\n\t\t\t\t// colorSpaceConversion: 'none'\n\t\t\t// });\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconsole.log('dsddd', blob);\n\t\t\t\t\t\t\treturn createImageBitmap(blob, {\n\t\t\t\t\t\t\t\tpremultiplyAlpha: 'none',\n\t\t\t\t\t\t\t\tcolorSpaceConversion: 'none'\n\t\t\t\t\t\t\t}).then(imageBitmap => {\n\t\t\t\t\t\t\t\tdata.imageBitmap = imageBitmap;\n\t\t\t\t\t\t\t\tif (prop._maxStyleSize < imageBitmap.width) { prop._maxStyleSize = imageBitmap.width; }\n\t\t\t\t\t\t\t\tif (prop._maxStyleSize < imageBitmap.height) { prop._maxStyleSize = imageBitmap.height; }\n\t\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t\t}).catch(console.warn);\n\t\t\t\t\t\t\t// resolve(data);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (prop._maxStyleSize < data.renderStyle.weight) { prop._maxStyleSize = data.renderStyle.weight; }\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t}\n\t\t\t\t\t// return data;\n\t\t\t\t})\n\t\t\t});\n\t\treturn {\n\t\t\tstylesPromise: Promise.all(out)\n\t\t};\n    },\n\n    parseMetaProps: function(prop) {\n        var meta = prop.MetaProperties || {},\n            ph = {};\n        ph.dataSource = prop.dataSource || prop.LayerID || '';\n\t\t[\n\t\t\t'srs',\t\t\t\t\t// проекция слоя\n\t\t\t'dataSource',\t\t\t// изменить dataSource через MetaProperties\n\t\t\t'gmxProxy',\t\t\t\t// установка прокачивалки\n\t\t\t'filter',\t\t\t\t// фильтр слоя\n\t\t\t'isGeneralized',\t\t// флаг generalization\n\t\t\t'isFlatten',\t\t\t// флаг flatten\n\t\t\t'multiFilters',\t\t\t// проверка всех фильтров для обьектов слоя\n\t\t\t'showScreenTiles',\t\t// показывать границы экранных тайлов\n\t\t\t'dateBegin',\t\t\t// фильтр по дате начало периода\n\t\t\t'dateEnd',\t\t\t\t// фильтр по дате окончание периода\n\t\t\t'shiftX',\t\t\t\t// сдвиг всего слоя\n\t\t\t'shiftY',\t\t\t\t// сдвиг всего слоя\n\t\t\t'shiftXfield',\t\t\t// сдвиг растров объектов слоя\n\t\t\t'shiftYfield',\t\t\t// сдвиг растров объектов слоя\n\t\t\t'quicklookPlatform',\t// тип спутника\n\t\t\t'quicklookX1',\t\t\t// точки привязки снимка\n\t\t\t'quicklookY1',\t\t\t// точки привязки снимка\n\t\t\t'quicklookX2',\t\t\t// точки привязки снимка\n\t\t\t'quicklookY2',\t\t\t// точки привязки снимка\n\t\t\t'quicklookX3',\t\t\t// точки привязки снимка\n\t\t\t'quicklookY3',\t\t\t// точки привязки снимка\n\t\t\t'quicklookX4',\t\t\t// точки привязки снимка\n\t\t\t'quicklookY4'\t\t\t// точки привязки снимка\n\t\t].forEach((k) => {\n\t\t\tif (k in meta) {\n\t\t\t\tph[k] = meta[k].Value || '';\n\t\t\t}\n\t\t});\n\t\tif (ph.gmxProxy && ph.gmxProxy.toLowerCase() === 'true') {\t\t// проверка прокачивалки\n\t\t\tph.gmxProxy = GMXPROXY;\n\t\t}\n\t\tif ('parentLayer' in meta) {\t\t\t\t\t// изменить dataSource через MetaProperties\n\t\t\tph.dataSource = meta.parentLayer.Value;\n\t\t}\n\n        return ph;\n    },\n\n    getTileAttributes: function(prop) {\n        let tileAttributeIndexes = {},\n            tileAttributeTypes = {};\n        if (prop.attributes) {\n            let attrs = prop.attributes,\n                attrTypes = prop.attrTypes || null;\n            if (prop.identityField) { tileAttributeIndexes[prop.identityField] = 0; }\n            for (let a = 0; a < attrs.length; a++) {\n                let key = attrs[a];\n                tileAttributeIndexes[key] = a + 1;\n                tileAttributeTypes[key] = attrTypes ? attrTypes[a] : 'string';\n            }\n        }\n        return {\n            tileAttributeTypes: tileAttributeTypes,\n            tileAttributeIndexes: tileAttributeIndexes\n        };\n    },\n\n\tgetStyleNum: function(itemArr, layerAttr, zoom) {\n\t\tlet indexes = layerAttr.tileAttributeIndexes;\n\t\tif (layerAttr.stylesParsed) {\n\t\t\tfor (let i = 0, len = layerAttr.stylesParsed.length; i < len; i++) {\n\t\t\t\tlet st = layerAttr.stylesParsed[i];\n\t\t\t\tif (zoom && (zoom < st.MinZoom || zoom > st.MaxZoom)) { continue; }\n\t\t\t\tif (st.filterFun(itemArr, indexes)) { return i; }\n\t\t\t}\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t\treturn -1;\n\t}\n};\n\n// const COMPARS = {WrapStyle: 'None', ftc: 'osm', srs: 3857};\n\n// const chkSignal = (signalName, signals, opt) => {\n\t// opt = opt || {};\n\t// let sObj = signals[signalName];\n\t\n\t// if (sObj) { sObj.abort(); }\n\t// sObj = signals[signalName] = new AbortController();\n\t// sObj.signal.addEventListener('abort', (ev) => console.log('Отмена fetch:', ev));\n\t// opt.signal = sObj.signal;\n\t// signals[signalName] = sObj;\n\t// return opt;\n// };\n\nconst chkHost = (hostName) => {\n\tconsole.log('chkVersion:', hostName, hosts);\n\tlet hostLayers = hosts[hostName],\n\t\tids = hostLayers.ids,\n\t\tarr = [];\n\n\tfor (let name in ids) {\n\t\tlet pt = ids[name],\n\t\t\tpars = { Name: name, Version: 'v' in pt ? pt.v : -1 };\n\t\tif (pt.dateBegin) {\n\t\t\tpars.dateBegin = pt.dateBegin;\n\t\t}\n\t\tif (pt.dateEnd) {\n\t\t\tpars.dateEnd = pt.dateEnd;\n\t\t}\n\t\tarr.push(pars);\n\t}\n\n\treturn Requests.getJson({\n\t\turl: '//' + hostName + SCRIPT,\n\t\toptions: Requests.chkSignal('chkVersion', hostLayers.signals),\n\t\tparamsArr: [Requests.COMPARS, {\n\t\t\tlayers: JSON.stringify(arr),\n\t\t\tbboxes: JSON.stringify(bbox || [WORLDBBOX]),\n\t\t\t// generalizedTiles: false,\n\t\t\tzoom: zoom\n\t\t}]\n\t}).then(json => {\n\t\tdelete hostLayers.signals.chkVersion;\n\t\treturn json;\n\t})\n\t.catch(err => {\n\t\tconsole.error(err);\n\t\t// resolve('');\n\t});\n};\nconst chkVersion = () => {\n\tfor (let host in hosts) {\n\t\tchkHost(host).then(json => {\n\t\t\tif (json.error) {\n\t\t\t\tconsole.warn('chkVersion:', json.error);\n\t\t\t} else {\n\t\t\t\tlet hostLayers = hosts[host],\n\t\t\t\t\tids = hostLayers.ids,\n\t\t\t\t\tres = json.res;\n\t\t\t\tif (res.Status === 'ok' && res.Result) {\n\t\t\t\t\tres.Result.forEach(it => {\n\t\t\t\t\t\tlet pt = ids[it.name],\n\t\t\t\t\t\t\tprops = it.properties;\n\t\t\t\t\t\tif (props) {\n\t\t\t\t\t\t\tpt.v = props.LayerVersion;\n\t\t\t\t\t\t\tpt.properties = props;\n\t\t\t\t\t\t\tpt.geometry = it.geometry;\n\t\t\t\t\t\t\tif (!pt.tileAttributeIndexes) {\n\t\t\t\t\t\t\t\tRequests.extend(pt, utils.getTileAttributes(props));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpt.hostName = host;\n\t\t\t\t\t\tpt.tiles = it.tiles;\n\t\t\t\t\t\tpt.tilesOrder = it.tilesOrder;\n\t\t\t\t\t\t// pt.tilesPromise = \n\t\t\t\t\t\tTilesLoader.load(pt);\n\t\t\t\t\t\tPromise.all(Object.values(pt.tilesPromise)).then((res) => {\n\t\t\t\t\t\t\t//self.postMessage({res: res, host: host, dmID: it.name, cmd: 'TilesData'});\n\n\t\t\t\tconsole.log('tilesPromise ___:', hosts, res);\n\t\t\t\t\t\t\t_waitCheckObservers();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// pt.tilesPromise.then(res => {\n\t\t\t\t// console.log('tilesPromise ___:', hosts, res);\n\t\t\t\t\t\t// });\n\t\t\t\t// console.log('chkVersion ___:', pt);\n\t\t\t\t\t});\n\t\t\t\t\t// resolve(res.Result.Key !== 'null' ? '' : res.Result.Key);\n\t\t\t\t// } else {\n\t\t\t\t\t// reject(json);\n\t\t\t\t\t// console.log('chkVersion key:', host, hosts);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\nconst addSource = (pars) => {\n\tpars = pars || {};\n\n\tlet id = pars.id;\n\t\n\tif ('zoom' in pars) { zoom = pars.zoom; }\n\tif ('bbox' in pars) { bbox = pars.bbox; }\n\t\t\n\tif (id) {\n\t\tlet hostName = pars.hostName || HOST;\n\t\tif (!hosts[hostName]) {\n\t\t\thosts[hostName] = {ids: {}, signals: {}};\n\t\t\tif (pars.apiKey) {\n\t\t\t\thosts[hostName].apiKeyPromise = Requests.getJson({\n\t\t\t\t\turl: '//' + hostName + '/ApiKey.ashx',\n\t\t\t\t\tparamsArr: [Requests.COMPARS, {\n\t\t\t\t\t\tKey: pars.apiKey\n\t\t\t\t\t}]\n\t\t\t\t}).then((json) => {\n\t\t\t\t\t// console.log('/ApiKey.ashx', json);\n\t\t\t\t\tlet res = json.res;\n\t\t\t\t\tif (res.Status === 'ok' && res.Result) {\n\t\t\t\t\t\thosts[hostName].Key = res.Result.Key;\n\t\t\t\t\t\treturn hosts[hostName].Key;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t\thosts[hostName].ids[id] = pars;\n        if (!intervalID) { utils.start(); }\n\t\tutils.now();\n\t} else {\n\t\tconsole.warn('Warning: Specify layer `id` and `hostName`', pars);\n\t}\n\tif (pars.vid) {\n\t\tlet parseLayers = hosts[pars.vHostName || HOST].parseLayers;\n\t\tif (parseLayers) {\n\t\t\tlet linkAttr = parseLayers.layersByID[pars.vid];\n\t\t\tRequests.extend(linkAttr, utils.parseStyles(linkAttr.properties));\n\t\t\tlinkAttr.stylesPromise.then((res) => {\n\t\t\t\tlinkAttr.styles = res;\n\t\t\t});\n\t\t}\n\t}\n\n// console.log('addSource:', pars);\n\treturn;\n};\n\nconst removeSource = (pars) => {\n\tpars = pars || {};\n\n\tlet id = pars.id;\n\tif (id) {\n\t\tlet hostName = pars.hostName || HOST;\n\t\tif (hosts[hostName]) {\n\t\t\tlet pt = hosts[hostName].ids[id];\nconsole.log('signals:', pt.signals, pt);\n\t\t\tif (pt.signals) {\n\t\t\t\tObject.values(pt.signals).forEach((it) => {\n\t\t\t\t\tit.abort();\n\t\t\t\t});\n\t\t\t}\n\t\t\tdelete hosts[hostName].ids[id];\n\t\t\tif (Object.keys(hosts[hostName].ids).length === 0) { delete hosts[hostName]; }\n\t\t\tif (Object.keys(hosts).length === 0) { utils.stop(); }\n\t\t}\n\t} else {\n\t\tconsole.warn('Warning: Specify layer id and hostName', pars);\n\t}\n// console.log('removeSource:', pars);\n\t//Requests.removeDataSource({id: message.layerID, hostName: message.hostName}).then((json) => {\n\treturn;\n};\n\nconst moveend = (pars) => {\n\tpars = pars || {};\nconsole.log('moveend:', pars);\n\t\n\tif ('zoom' in pars) { zoom = pars.zoom; }\n\tif ('bbox' in pars) { bbox = pars.bbox; }\n\t\t\n\tutils.now();\n\treturn;\n};\n\nlet _checkObserversTimer = null;\nconst _waitCheckObservers = () => {\n\tif (_checkObserversTimer) { clearTimeout(_checkObserversTimer); }\n\t_checkObserversTimer = setTimeout(checkObservers, 25);\n};\n/*\nconst chkTiles = (opt) => {\n\tlet\tarr = [],\n\t\ttcnt = 0,\n\t\tpars = opt.observer.pars,\n\t\t// dateInterval = pars.dateInterval,\n\t\tobbox = pars.bbox;\n\tfor (let i = 0, len = opt.tiles.length; i < len; i++) {\n\t\tlet tile = opt.tiles[i],\n\t\t\tbbox = tile.bbox;\n\t\tif (bbox[0] > obbox.max.x || bbox[2] < obbox.min.x || bbox[1] > obbox.max.y || bbox[3] < obbox.min.y) {continue;}\n\t\ttcnt++;\n\t}\nconsole.log('chkTiles _1______________:', tcnt, pars.zKey, opt); //, tile.z, tile.x, tile.y, tile.span, tile.level);\n\treturn arr;\n\n};\n*/\nconst getStyleNum = (arr, styles, indexes, z) => {\n\t// let out = -1;\n\treturn 0;\n};\n\nconst _parseItem = ({item, st, bounds, hiddenLines, pars}) => {\n\t// let geo = item[item.length - 1],\n\t\t// type = geo.type,\n\t\t// z = pars.z;\n\t\n\treturn {\n\t};\n};\n\nconst _checkVectorTiles = ({arrTiles, observers, styles, indexes, sort}) => {\n\tfor (let i = 0, len = arrTiles.length; i < len; i++) {\n\t\tlet tile = arrTiles[i],\n\t\t\tpixels = tile.pixels,\n\t\t\tstyleNums = tile.styleNums,\n\t\t\titemsbounds = tile.itemsbounds,\n\t\t\thiddenLines = tile.hiddenLines;\n\t\tif (!styleNums) {styleNums = tile.styleNums = [];}\n\t\tif (!itemsbounds) {itemsbounds = tile.itemsbounds = [];}\n\t\tif (!hiddenLines) {hiddenLines = tile.hiddenLines = [];}\n\t\tif (!pixels) {pixels = tile.pixels = [];}\n\t\tfor (let zKey in observers) {\n\t\t\tlet observer = observers[zKey];\n\t\t\t// let flag = observer.bounds.intersects(tile.bounds);\n\n\t\t\t// if (!observer.bounds.intersects(tile.bounds)) {\n\t\t\t\t// continue;\n\t\t\t// }\n\n\t\t\tif (!observer.tcnt) {observer.tcnt = 0;}\n\t\t\tobserver.tcnt++;\n\t\t\tobserver.items = [];\n\t\t\ttile.values.forEach((it, n) => {\n\t\t\t\t// let parsed = \n\t\t\t\t_parseItem({\n\t\t\t\t\thiddenLines: hiddenLines[n],\n\t\t\t\t\tbounds: itemsbounds[n],\n\t\t\t\t\tst: styleNums[n],\n\t\t\t\t\tpars: observer.pars,\n\t\t\t\t\titem: it\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tlet geo = it[it.length - 1],\n\t\t\t\t\tst = styleNums[n],\n\t\t\t\t\tbounds = itemsbounds[n];\n\t\t\t\tif (st === undefined) {\n\t\t\t\t\tst = getStyleNum(it, styles, indexes, observer.pars.z);\n\t\t\t\t\ttile.styleNums[n] = styleNums[n] = st;\n\t\t\t\t}\n\t\t\t\tif (!bounds) {\n\t\t\t\t\tbounds = Requests.geoItemBounds(geo);\n\t\t\t\t\ttile.itemsbounds[n] = itemsbounds[n] =  bounds;\n\t\t\t\t}\n\n\t\t\t\tlet pt = {\n\t\t\t\t\tst: st,\n\t\t\t\t\titemData: {\n\t\t\t\t\t\tbounds: bounds,\n\t\t\t\t\t\titem: it\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t// TODO: если НЕТ сортировки объектов то тут отрисовка иначе после сортировки\n\t\t\t\tif (sort) {\n\t\t\t\t\tobserver.items.push(pt);\n\t\t\t\t} else {\n\t\t\t\t\tpt.observer = observer;\n\t\t\t\t\tdrawItem(pt);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\nconsole.log('checkObservers _____1__________:', hosts);\n};\n\nconst checkObservers = () => {\n\tconsole.log('checkObservers _______________:', hosts);\n\tObject.keys(hosts).forEach(host => {\n\t\tObject.keys(hosts[host].ids).forEach(layerID => {\n\t\t\tlet\ttData = hosts[host].ids[layerID],\n\t\t\t\tlayerData = hosts[host].parseLayers.layersByID[layerID],\n\t\t\t\tstyles = layerData.styles || [],\n\t\t\t\t// oKeys = Object.keys(tData.observers),\n\t\t\t\tobservers = tData.observers || {},\n\t\t\t\tindexes = tData.tileAttributeIndexes,\n\t\t\t\ttilesPromise = tData.tilesPromise;\n\t\t\tif (tilesPromise) {\n\t\t\t\tlayerData.stylesPromise.then((arrStyle) => {\n\t\t\t\t\tlet _maxStyleSize = layerData.properties._maxStyleSize || 128;\n\t\t\t\t\tObject.keys(observers).forEach(key => {\n\t\t\t\t\t\tlet observer = observers[key];\n\t\t\t\t\t\tif (!observer.bounds) {\n\t\t\t\t\t\t\tlet coords = observer.pars.coords,\n\t\t\t\t\t\t\t\tz = observer.pars.z;\n\t\t\t\t\t\t\t_maxStyleSize = utils._getMaxStyleSize(z, styles);\n\n\t\t\t\t\t\t\t// var mercSize = 2 * _maxStyleSize * WORLDWIDTHFULL / Math.pow(2, 8 + z); //TODO: check formula\n\n\t\t\t\t\t\t\tobserver.bounds = utils.getTileBounds(coords);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t\tPromise.all(Object.values(tilesPromise)).then((arrTiles) => {\n\t\t\t\t\t\t_checkVectorTiles({\n\t\t\t\t\t\t\tsort: layerData.sorting,\n\t\t\t\t\t\t\tarrTiles: arrTiles,\n\t\t\t\t\t\t\tobservers: observers,\n\t\t\t\t\t\t\tstyles: styles,\n\t\t\t\t\t\t\tindexes: indexes\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfor (let zKey in observers) {\n\t\t\t\t\t\t\tlet observer = observers[zKey],\n\t\t\t\t\t\t\t\tpars = observer.pars;\n\t\t\t\t\t\t\tpars.bitmap = observer.canvas.transferToImageBitmap();\n\t\t\t\t\t\t\tobserver.resolver(pars);\n\t\t\t\t\t\t\t// observer.resolver({\n\t\t\t\t\t\t\t\t// bitmap: observer.canvas.transferToImageBitmap()\n\t\t\t\t\t\t\t// });\n\t\t\t\t\t\t}\n\t\t\t\t\t\t/*\n\t\t\t\t\t\tfor (let i = 0, len = arrTiles.length; i < len; i++) {\n\t\t\t\t\t\t\tlet tile = arrTiles[i],\n\t\t\t\t\t\t\t\tstyleNums = tile.styleNums,\n\t\t\t\t\t\t\t\titemsbounds = tile.itemsbounds;\n\t\t\t\t\t\t\tif (!styleNums) {styleNums = tile.styleNums = [];}\n\t\t\t\t\t\t\tif (!itemsbounds) {itemsbounds = tile.itemsbounds = [];}\n\t\t\t\t\t\t\tfor (let j = 0, len1 = oKeys.length; j < len1; j++) {\n\t\t\t\t\t\t\t\tlet zKey = oKeys[j],\n\t\t\t\t\t\t\t\t\tobserver = tData.observers[zKey];\n\n\t\t\t\t\t\t\t\tif (!observer || !observer.bounds.intersects(tile.bounds)) {continue;}\n\n\t\t\t\t\t\t\t\tif (!observer.tcnt) {observer.tcnt = 0;}\n\t\t\t\t\t\t\t\tobserver.tcnt++;\n\t\t\t\t\t\t\t\tobserver.items = [];\n\t\t\t\t\t\t\t\ttile.values.forEach((it, n) => {\n\t\t\t\t\t\t\t\t\tlet geo = it[it.length - 1],\n\t\t\t\t\t\t\t\t\t\tst = styleNums[n],\n\t\t\t\t\t\t\t\t\t\tbounds = itemsbounds[n];\n\t\t\t\t\t\t\t\t\tif (st === undefined) {st = styleNums[n] = getStyleNum(it, styles, tData.tileAttributeIndexes, observer.pars.z);}\n\t\t\t\t\t\t\t\t\tif (!bounds) {bounds = itemsbounds[n] = Requests.geoItemBounds(geo);}\n\n\t\t\t\t\t\t\t\t\tobserver.items.push(it);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t*/\n\t\t\tconsole.log('checkObservers _____1__________:', hosts, arrStyle);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n};\n\nconst addObserver = (pars) => {\n\nconsole.log('addObserver_______________:', pars, hosts);\n\treturn new Promise((resolve) => {\n\t\tlet layerID = pars.layerID,\n\t\t\tzKey = pars.zKey,\n\t\t\thost = hosts[pars.hostName || HOST],\n\t\t\tout = {};\n\t\tif (host && host.parseLayers && host.parseLayers.layersByID[layerID]) {\n\t\t\t// let stData = host.parseLayers.layersByID[layerID],\n\t\t\tlet\ttData = host.ids[layerID];\n\t\t\tif (!tData.observers) { tData.observers = {}; }\n\t\t\t// let bounds = Requests.bounds();\n\t\t\tif (pars.bbox) { bounds = bounds.extendBounds(pars.bbox); }\n\t\t\ttData.observers[zKey] = {\n\t\t\t\t// bounds: bounds,\n\t\t\t\tpars: pars,\n\t\t\t\tresolver: resolve\n\t\t\t};\n// console.log('addObserver ____1_______:', stData, tData);\n\t\t\t// start Recheck Observers on next frame\n\t\t\t_waitCheckObservers();\n\t\t\t// out.data = layerID;\n\t\t\t// resolve(out);\n\t\t} else {\n\t\t\tout.error = 'Нет слоя: ' + layerID;\n\t\t\tresolve(out);\n\t\t}\n\t});\n};\n\nconst removeObserver = (pars) => {\n\tlet host = hosts[pars.hostName];\n\tif (host && host.ids[pars.layerID]) {\n\t\tlet observers = host.ids[pars.layerID].observers;\n\t\tif (observers) {\n\t\t\tobservers[pars.zKey].resolver([]);\n\t\t\tdelete observers[pars.zKey];\n\t\t}\n\t}\nconsole.log('removeObserver _______________:', pars, hosts);\n};\n\nconst setDateInterval = (pars) => {\n\tpars = pars || {};\n\tlet host = hosts[pars.hostName];\n\tif (host && host.ids[pars.id]) {\n\t\thost.ids[pars.id].dateBegin = pars.dateBegin;\n\t\thost.ids[pars.id].dateEnd = pars.dateEnd;\n\t}\n\tutils.now();\n\nconsole.log('setDateInterval:', pars, hosts);\n};\n\nconst _iterateNodeChilds = (node, level, out) => {\n\tlevel = level || 0;\n\tout = out || {\n\t\tlayers: [],\n\t\tlayersByID: {}\n\t};\n\t\n\tif (node) {\n\t\tlet type = node.type,\n\t\t\tcontent = node.content,\n\t\t\tprops = content.properties;\n\t\tif (type === 'layer') {\n\t\t\tlet ph = {\n\t\t\t\tproperties: props,\n\t\t\t\tlevel: level\n\t\t\t};\n\t\t\t// let ph = utils.parseLayerProps(props);\n\t\t\t// ph.level = level;\n\t\t\tif (content.geometry) { ph.geometry = content.geometry; }\n\t\t\tout.layers.push(ph);\n\t\t\tout.layersByID[props.name] = ph;\n\t\t} else if (type === 'group') {\n\t\t\tlet childs = content.children || [];\n\t\t\tout.layers.push({ level: level, group: true, childsLen: childs.length, properties: props });\n\t\t\tchilds.map((it) => {\n\t\t\t\t_iterateNodeChilds(it, level + 1, out);\n\t\t\t});\n\t\t}\n\t\t\n\t} else {\n\t\treturn out;\n\t}\n\treturn out;\n};\n\nconst parseTree = (json) => {\n\tlet out = {};\n\tif (json.Status === 'error') {\n\t\tout = json;\n\t} else if (json.Result && json.Result.content) {\n\t\tout = _iterateNodeChilds(json.Result);\n\t\tout.mapAttr = out.layers.shift();\n\t}\n// console.log('______json_out_______', out, json)\n\treturn out;\n};\n\nconst getMapTree = (pars) => {\n\tpars = pars || {};\n\tlet hostName = pars.hostName || HOST,\n\t\thost = hosts[hostName];\n\n\treturn new Promise((resolve) => {\n\t\tif (host && host.layerTree) {\n\t\t\tresolve(host.layerTree);\n\t\t} else {\n\t\t\tlet apiKeyPromise = !host || !host.apiKeyPromise ? Requests.getJson({\n\t\t\t\t\turl: '//' + hostName + '/ApiKey.ashx',\n\t\t\t\t\tparamsArr: [{\n\t\t\t\t\t\tKey: pars.apiKey\n\t\t\t\t\t}]\n\t\t\t\t}) : host.apiKeyPromise;\n\n\t\t\t// if (!host || !host.apiKeyPromise) {\n\t\t\t\t// host.apiKeyPromise = Requests.getJson({\n\t\t\t\t\t// url: '//' + hostName + '/ApiKey.ashx',\n\t\t\t\t\t// paramsArr: [{\n\t\t\t\t\t\t// Key: pars.apiKey\n\t\t\t\t\t// }]\n\t\t\t\t// });\n\t\t\t\t\n\t\t\t// }\n\t\t\tapiKeyPromise.then(json => {\n\t\t\t\t// console.log('/ApiKey.ashx', json);\n\t\t\t\tlet res = json.res;\n\t\t\t\tif (res.Status === 'ok' && res.Result) {\n\t\t\t\t\treturn res.Result.Key;\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t})\n\t\t\t.then(apiKey => {\n\t\t\t\tRequests.getJson({\n\t\t\t\t\turl: '//' + hostName + '/Map/GetMapFolder',\n\t\t\t\t\t// options: {},\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tapiKey: apiKey,\n\t\t\t\t\t\tsrs: 3857, \n\t\t\t\t\t\tskipTiles: 'All',\n\t\t\t\t\t\tmapId: pars.mapID,\n\t\t\t\t\t\tfolderId: 'root',\n\t\t\t\t\t\tvisibleItemOnly: false\n\t\t\t\t\t}\n\t\t\t\t}).then(json => {\n\t\t\t\t\tif (!hosts[hostName]) { hosts[hostName] = {ids: {}, signals: {}}; }\n\t console.log('getMapTree:', hosts, json);\n\t\t\t\t\tresolve(json);\n\t\t\t\t\thosts[hostName].layerTree = json.res.Result;\n\t\t\t\t\thosts[hostName].parseLayers = parseTree(json.res);\n\t\t\t\t\tif (apiKey) {\n\t\t\t\t\t\thosts[hostName].apiKeyPromise = apiKeyPromise;\n\t\t\t\t\t\thosts[hostName].apiKey = apiKey;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t});\n};\n\nconst drawTest = (pars) => {\n\tconst canvas = new OffscreenCanvas(256, 256),\n\t// const canvas = message.canvas,\n\t\tw = canvas.width,\n\t\th = canvas.height,\n\t\tctx = canvas.getContext('2d');\n\t\t// gl = canvas.getContext('webgl');\n\t// ctx.fillStyle = 'red';\n\t// ctx.lineWidth = 5;\n\t// ctx.rect(5, 5, w - 5, h - 5);\n\t// ctx.fill();\n\t\n\tRenderer2d.updatePoly({\n\t\tcoords: pars.coords,\n\t\t_drawing: true,\n\t\tclosed: true,\n\t\t_ctx: ctx,\n\t\tcanvas: canvas,\n\t\tw: w,\n\t\th: h,\n\t\toptions: pars.options || {\n\t\t\tfillRule: 'evenodd',\n\t\t\t_dashArray: null,\n\t\t\tlineCap: \"butt\",\n\t\t\tlineJoin: \"miter\",\n\t\t\tcolor: \"green\",\n\t\t\tfillColor: \"blue\",\n\t\t\tinteractive: true,\n\t\t\tsmoothFactor: 1,\n\t\t\tweight: 10,\n\t\t\topacity: 1,\n\t\t\tfillOpacity: 1,\n\t\t\tstroke: true,\n\t\t\tfill: false\n\t\t},\n\t\t_parts: pars._parts || [[{\"x\":0,\"y\":0},{\"x\":255,\"y\":255},{\"x\":255,\"y\":0},{\"x\":0,\"y\":255}]]\n\t\t// _parts: message._parts || [[{\"x\":54,\"y\":40},{\"x\":95,\"y\":40},{\"x\":95,\"y\":88}]]\n\t});\n\t// delete message. ;\n\t// message.out = {done: true};\n\t// let bitmap = canvas.transferToImageBitmap();\n\treturn {\n\t\tbitmap: canvas.transferToImageBitmap()\n\t};\n};\n\nconst drawTile = (pars) => {\n\tpars = pars || {};\n\tlet hostName = pars.hostName || HOST,\n\t\tlayerID = pars.layerID,\n\t\thost = hosts[hostName],\n\t\tparsedLayer = host.parseLayers.layersByID[layerID],\n\t\tids = host.ids[layerID];\n // console.log('drawTile:', pars);\n\n\treturn new Promise((resolve) => {\n\t\tparsedLayer.stylesPromise.then(st => {\n\t\t\tPromise.all(Object.values(ids.tilesPromise)).then((res) => {\n\n\tconsole.log('drawTile tilesPromise ___:', st, res);\n\t\t\t\tresolve(Requests.extend(\n\t\t\t\t\tdrawTest(pars), pars\n\t\t\t\t));\n\t\t\t});\n\t\t});\n\t\t// if (host && host.layerTree) {\n\t\t\t// resolve(host.layerTree);\n\t\t// } else {\n\t\t\t// Requests.getJson({\n\t\t\t\t// url: '//' + hostName + '/Map/GetMapFolder',\n\t\t\t\t// options: {},\n\t\t\t\t// params: {\n\t\t\t\t\t// srs: 3857, \n\t\t\t\t\t// skipTiles: 'All',\n\t\t\t\t\t// mapId: pars.mapID,\n\t\t\t\t\t// folderId: 'root',\n\t\t\t\t\t// visibleItemOnly: false\n\t\t\t\t// }\n\t\t\t// }).then(json => {\n\t\t\t\t// if (!hosts[hostName]) { hosts[hostName] = {ids: {}, signals: {}}; }\n // console.log('getMapTree:', hosts, json);\n\t\t\t\t// resolve(json);\n\t\t\t\t// hosts[hostName].layerTree = json.res.Result;\n\t\t\t\t// hosts[hostName].parseLayers = parseTree(json.res);\n\t\t\t// })\n\t\t// }\n\t});\n};\n\nconst _parseGeo = (pars) => {\n\tlet observer = pars.observer,\n\t\ttn = observer.pars.coords,\n\t\titemData = pars.itemData,\n\t\titem = itemData.item,\n\t\t\n\t\tgeo = item[item.length - 1],\n\t\tgeoType = geo.type,\n\t\tout;\n\t\n    if (geoType === 'POLYGON' || geoType === 'MULTIPOLYGON') {\n\t\tlet coords = geo.coordinates;\n\t\tif (geoType === 'POLYGON') { coords = [coords]; }\n\t\tout = utils.getCoordsPixels({\n\t\t\tcoords: coords,\n\t\t\tz: tn.z,\n\t\t\ttpx: pars.tpx,\n\t\t\ttpy: pars.tpy\n\t\t});\n\t}\n\treturn out;\n};\n\nconst drawItem = (pars) => {\n\tlet observer = pars.observer,\n\t\tctx = observer.ctx,\n\t\titemData = pars.itemData,\n\t\titem = itemData.item,\n\t\tlast = item.length - 1,\n\t\tgeo = item[last],\n\t\ttype = geo.type,\n\t\tcoords = observer.pars.coords,\n\t\ttz = Math.pow(2, coords.z),\n\t\t// tpx = 256 * coords.x,\n\t\t// tpy = 256 * coords.y,\n\t\ttpx = 256 * Math.abs(coords.x % tz),\n\t\ttpy = 256 * Math.abs(coords.y % tz),\n\t\t// tpy = 256 * (1 + coords.y),\n\n\t\tpt = {\n\t\t\t_merc: true,\t\t// TODO: рисование напрямую из Меркатора\n\t\t\tmInPixel: Math.pow(2, coords.z + 8) / WORLDWIDTHFULL,\n\t\t\t_drawing: true,\n\t\t\tclosed: true,\n\t\t\t_ctx: ctx,\n\t\t\ttpx: tpx,\n\t\t\ttpy: tpy,\n\t\t\titemData: itemData,\n\t\t\toptions: pars.options || {\n\t\t\t\tfillRule: 'evenodd',\n\t\t\t\t_dashArray: null,\n\t\t\t\tlineCap: \"butt\",\n\t\t\t\tlineJoin: \"miter\",\n\t\t\t\tcolor: \"green\",\n\t\t\t\tfillColor: \"blue\",\n\t\t\t\tinteractive: true,\n\t\t\t\tsmoothFactor: 1,\n\t\t\t\tweight: 10,\n\t\t\t\topacity: 1,\n\t\t\t\tfillOpacity: 1,\n\t\t\t\tstroke: true,\n\t\t\t\tfill: false\n\t\t\t},\n\t\t\t_parts: itemData.pixels || [[{\"x\":0,\"y\":0},{\"x\":255,\"y\":255},{\"x\":255,\"y\":0},{\"x\":0,\"y\":255}]]\n\t\t};\n\t/*\n\t// TODO: рисование напрямую из Меркатора\n\t\ttpx - сдвиг px по X\n\t\ttpy - сдвиг px по Y\n\t*/\n// if (coords.x === -1 && coords.y === 0 && coords.z === 1) {\n\tconsole.log('ddd', coords, pt);\n// }\n\tif (!itemData.pixels) {\n\t\tpars.tpx = tpx;\n\t\tpars.tpy = tpy;\n\t\tlet tt = _parseGeo(pars);\n\t\titemData.pixels = tt.coords;\n\t\titemData.hidden = tt.hidden;\n\t}\n\tif (!ctx) {\n\t\tconst canvas = new OffscreenCanvas(256, 256);\n\t\tcanvas.width = canvas.height = 256;\n\t\tobserver.canvas = canvas;\n\t\t\n\t// const canvas = message.canvas,\n\t\t// w = canvas.width,\n\t\t// h = canvas.height,\n\t\tpt._ctx = observer.ctx = canvas.getContext('2d');\n\t\t\n\t}\n\npt._ctx.fillText(coords.x + ':' + coords.y + ':' + coords.z, 128, 128);\n\tRenderer2d.updatePoly(pt);\n\t// delete message. ;\n\t// message.out = {done: true};\n\t// let bitmap = canvas.transferToImageBitmap();\n\t// return {\n\t\t// bitmap: canvas.transferToImageBitmap()\n\t// };\n}\n\nconst getTiles = (message) => {\n\tlet hostName = message.hostName,\n\t\tlayerID = message.layerID,\n\t\tqueue = message.queue,\n\t\tz = message.z,\n\t\thostLayers = hosts[hostName];\n\n\tif (hostLayers && hostLayers.ids && hostLayers.ids[layerID]) {\n\t\tlet observers = hostLayers.ids[layerID].observers;\n\t\tfor (let key in observers) {\n\t\t\tif (observers[key].pars.z !== z) {\n\t\t\t\tobservers[key].resolver(null);\n\t\t\t\tdelete observers[key];\n\t\t\t}\n\t\t}\n\t}\n// console.log('vvvvvvvvvv ___res____ ', message);\n\treturn Promise.all(queue.map(coords => \n\t\taddObserver(Requests.extend({\n\t\t\tcoords: coords,\n\t\t\tzKey: coords.x + ':' + coords.y + ':' + coords.z\n\t\t}, message))\n\t));\n};\n\nexport default {\n\tgetTiles,\n\tdrawTile,\n\taddObserver,\n\tremoveObserver,\n\tgetMapTree,\n\tsetDateInterval,\n\tmoveend,\n\tremoveSource,\n\taddSource\n};","import Requests from './Requests.js';\r\nimport DataVersion from './DataSourceVersion';\r\nimport Renderer2d from './Renderer2d';\r\n\r\nvar _self = self;\r\n(_self.on || _self.addEventListener).call(_self, 'message', e => {\r\n    const message = e.data || e;\r\n// console.log('in message ', e);\r\n    switch (message.cmd) {\r\n\t\tcase 'getTiles':\r\nconsole.log('getTiles ', message);\r\n/*\r\n\t\t\tPromise.all(message.queue.map(coords => \r\n\t\t\t\tDataVersion.addObserver(Requests.extend({\r\n\t\t\t\t\tcoords: coords,\r\n\t\t\t\t\tzKey: coords.x + ':' + coords.y + ':' + coords.z\r\n\t\t\t\t}, message))\r\n\t\t\t\t// .then((json) => {\r\n\t\t\t\t\t//message.out = json;\r\n\t\t\t// console.log('vvvvvvvvvv ___res____ ', message);\r\n\t\t\t\t\t//_self.postMessage(message);\r\n\t\t\t\t\t// return json;\r\n\t\t\t\t// })\r\n\t\t\t\t//DataVersion.drawTile(Requests.extend({coords: coords}, message))\r\n\t\t\t\t\r\n\t\t\t))\r\n\t\t\t*/\r\n\t\t\tDataVersion.getTiles(message)\r\n\t\t\t.then(arr => {\r\nconsole.log('getTiles111 ', arr);\r\n\t\t\t\tmessage.out = arr;\r\n\t\t\t\t_self.postMessage(message);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tcase 'addCanvasTile':\r\n\t\t\tconst canvas = new OffscreenCanvas(256, 256),\r\n\t\t\t// const canvas = message.canvas,\r\n\t\t\t\tw = canvas.width,\r\n\t\t\t\th = canvas.height,\r\n\t\t\t\tctx = canvas.getContext('2d');\r\n\t\t\t\t// gl = canvas.getContext('webgl');\r\n\t\t\t// ctx.fillStyle = 'red';\r\n\t\t\t// ctx.lineWidth = 5;\r\n\t\t\t// ctx.rect(5, 5, w - 5, h - 5);\r\n\t\t\t// ctx.fill();\r\n\t\t\tRenderer2d.updatePoly({\r\n\t\t\t\tcoords: message.coords,\r\n\t\t\t\t_drawing: true,\r\n\t\t\t\tclosed: true,\r\n\t\t\t\t_ctx: ctx,\r\n\t\t\t\tcanvas: canvas,\r\n\t\t\t\tw: w,\r\n\t\t\t\th: h,\r\n\t\t\t\toptions: message.options || {\r\n\t\t\t\t\tfillRule: 'evenodd',\r\n\t\t\t\t\t_dashArray: null,\r\n\t\t\t\t\tlineCap: \"butt\",\r\n\t\t\t\t\tlineJoin: \"miter\",\r\n\t\t\t\t\tcolor: \"green\",\r\n\t\t\t\t\tfillColor: \"blue\",\r\n\t\t\t\t\tinteractive: true,\r\n\t\t\t\t\tsmoothFactor: 1,\r\n\t\t\t\t\tweight: 10,\r\n\t\t\t\t\topacity: 1,\r\n\t\t\t\t\tfillOpacity: 1,\r\n\t\t\t\t\tstroke: true,\r\n\t\t\t\t\tfill: false\r\n\t\t\t\t},\r\n\t\t\t\t_parts: message._parts || [[{\"x\":0,\"y\":0},{\"x\":255,\"y\":255},{\"x\":255,\"y\":0},{\"x\":0,\"y\":255}]]\r\n\t\t\t\t// _parts: message._parts || [[{\"x\":54,\"y\":40},{\"x\":95,\"y\":40},{\"x\":95,\"y\":88}]]\r\n\t\t\t});\r\n\t\t\t// delete message. ;\r\n\t\t\tmessage.out = {done: true};\r\n\t\t\tmessage.bitmap = canvas.transferToImageBitmap();\r\n\t\t\t_self.postMessage(message, [message.bitmap]);\r\n\t\t\tbreak;\r\n\t\tcase 'getLayerItems':\r\n\t\t\tRequests.getLayerItems({layerID: message.layerID}).then((json) => {\r\n\t\t\t\tmessage.out = json;\r\n\t\t\t\tlet pt = {};\r\n\t\t\t\tjson.Result.fields.forEach((name, i) => { pt[name] = i; });\r\n\t\t\t\tjson.Result.fieldKeys = pt;\r\n\t\t\t\t_self.postMessage(message);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tcase 'getMap':\r\n\t\t\tDataVersion.getMapTree({mapID: message.mapID, apiKey: message.apiKey, hostName: message.hostName, search: message.search}).then((json) => {\r\n\t\t\t// Requests.getMapTree({mapID: message.mapID, hostName: message.hostName, search: message.search}).then((json) => {\r\n\t\t\t\tmessage.out = json;\r\n\t\t\t\t_self.postMessage(message);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tcase 'setSyncParams':\r\n\t\t\tRequests.setSyncParams(message.syncParams);\r\n\t\t\tbreak;\r\n\t\tcase 'getSyncParams':\r\n\t\t\tmessage.syncParams = Requests.getSyncParams(message.stringFlag);\r\n\t\t\t_self.postMessage(message);\r\n\t\t\tbreak;\r\n\t\tcase 'addDataSource':\r\n\t\t\tDataVersion.addSource(message);\r\n\t\t\t// .then((json) => {\r\n\t\t\t\t// message.out = json;\r\n\t\t\t\t// _self.postMessage(message);\r\n\t\t\t// });\r\n\t\t\tbreak;\r\n\t\tcase 'removeDataSource':\r\n\t\t\tDataVersion.removeSource({id: message.id, hostName: message.hostName});\r\n\t\t\tbreak;\r\n\t\tcase 'addObserver':\r\n\t\t\tDataVersion.addObserver(message).then((json) => {\r\n\t\t\t\tmessage.out = json;\r\n\t\tconsole.log('vvvvvvvvvv ___res____ ', message);\r\n\t\t\t\t_self.postMessage(message);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tcase 'removeObserver':\r\n\t\t\tDataVersion.removeObserver(message);\r\n\t\t\tbreak;\r\n\t\tcase 'setDateInterval':\r\n\t\t\tDataVersion.setDateInterval(message);\r\n\t\t\tbreak;\r\n\t\tcase 'moveend':\r\n\t\t\tDataVersion.moveend(message);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tconsole.warn('Неизвестная команда:', message.cmd);\r\n\t\t\tbreak;\r\n\t}\r\n});\r\n\r\n"],"names":["_self","self","window","str","location","origin","_protocol","substring","indexOf","syncParams","fetchOptions","mode","credentials","COMPARS","WrapStyle","ftc","srs","setSyncParams","hash","getSyncParams","stringFlag","res","arr","key","push","join","parseURLParams","sp","URLSearchParams","search","out","p","k","z","main","keys","utils","extend","dest","i","j","len","src","arguments","length","makeTileKeys","it","ptiles","tklen","tilesOrder","tiles","newTiles","t","splice","tk","tile","data","tp","x","y","v","s","d","getZoomRange","info","properties","styles","st","Math","min","MinZoom","max","MaxZoom","chkProtocol","url","substr","getFormBody","par","Object","map","encodeURIComponent","chkResponse","resp","type","status","Promise","reject","contentType","headers","get","blob","json","text","getBitMap","options","fetch","then","getTileJson","queue","params","paramsArr","forEach","getJson","opt","method","body","load","catch","err","error","toString","geoItemBounds","geo","bounds","boundsArr","coords","coordinates","b","Bounds","arr1","len1","extendBounds","chkSignal","signalName","signals","sObj","abort","AbortController","signal","addEventListener","ev","console","log","Number","MAX_VALUE","extendArray","prototype","addBuffer","dxmin","dymin","dxmax","dymax","contains","point","getCenter","addOffset","offset","intersects","min2","max2","intersectsWithDelta","dx","dy","isEqual","isNodeIntersect","num","TILE_PREFIX","pars","tilesPromise","pb","slice","tkey","tHash","reduce","c","Requests","hostName","r","ModeKey","LayerName","id","replace","JSON","parse","bbox","_reqParse","ph","canvas","_ctx","getContext","w","width","h","height","_clear","size","getSize","clearRect","save","setTransform","restore","_draw","beginPath","rect","clip","_drawing","order","_drawFirst","next","layer","_pxBounds","_updatePoly","len2","parts","itemData","pixels","_parts","ctx","closed","closePath","_fillStroke","_updatePolyMerc","mInPixel","item","translate","tpx","tpy","scale","_updateCircle","_point","round","_radius","_radiusY","arc","PI","fill","globalAlpha","fillOpacity","fillStyle","fillColor","color","fillRule","stroke","weight","setLineDash","_dashArray","opacity","lineWidth","strokeStyle","lineCap","lineJoin","draw","updatePolyMerc","updatePoly","updateCircle","fillStroke","clear","HOST","WORLDWIDTHFULL","W","WORLDBBOX","SCRIPT","GMXPROXY","MINZOOM","MAXZOOM","STYLEKEYS","marker","server","client","outline","label","hosts","zoom","delay","intervalID","timeoutID","getCoordsPixels","attr","hiddenLines","hidden","pow","ringMerc","getRingPixels","hiddenFlag","cnt","cntHide","lastX","lastY","vectorSize","lineIsOnEdge","x1","y1","x2","y2","now","clearTimeout","setTimeout","chkVersion","stop","clearInterval","start","msec","setInterval","parseFilter","regex1","regex2","regexMath","filter","filterParsed","filterFun","Function","decodeOldStyle","style","key1","styleOut","newKey","zn","iconAnchor","getTileBounds","tileSize","minx","miny","_getMaxStyleSize","maxSize","RenderStyle","_needLoadIcons","maxShift","iconCenter","abs","parseStyles","prop","_maxStyleSize","resolve","Filter","renderStyle","iconUrl","image","createImageBitmap","premultiplyAlpha","colorSpaceConversion","imageBitmap","warn","stylesPromise","all","parseMetaProps","meta","MetaProperties","dataSource","LayerID","Value","gmxProxy","toLowerCase","parentLayer","getTileAttributes","tileAttributeIndexes","tileAttributeTypes","attributes","attrs","attrTypes","identityField","a","getStyleNum","itemArr","layerAttr","indexes","stylesParsed","chkHost","hostLayers","ids","name","pt","Name","Version","dateBegin","dateEnd","layers","stringify","bboxes","host","Status","Result","props","LayerVersion","geometry","TilesLoader","values","_waitCheckObservers","addSource","apiKey","apiKeyPromise","Key","vid","parseLayers","vHostName","linkAttr","layersByID","removeSource","moveend","_checkObserversTimer","checkObservers","_parseItem","_checkVectorTiles","arrTiles","observers","sort","styleNums","itemsbounds","zKey","observer","tcnt","items","n","undefined","drawItem","layerID","tData","layerData","arrStyle","sorting","bitmap","transferToImageBitmap","resolver","addObserver","removeObserver","setDateInterval","_iterateNodeChilds","node","level","content","childs","children","group","childsLen","parseTree","mapAttr","shift","getMapTree","layerTree","skipTiles","mapId","mapID","folderId","visibleItemOnly","drawTest","OffscreenCanvas","Renderer2d","interactive","smoothFactor","drawTile","parsedLayer","_parseGeo","tn","geoType","last","tz","_merc","tt","fillText","getTiles","message","on","call","e","cmd","DataVersion","postMessage","done","getLayerItems","fields","fieldKeys"],"mappings":"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"}
{"version":3,"file":"index.js","sources":["src/worker/Requests.js","src/worker/TilesLoader.js","src/worker/DataSourceVersion.js","src/worker/index.js"],"sourcesContent":["\r\nconst\t_self = self || window,\r\n\t\tserverBase = _self.serverBase || 'maps.kosmosnimki.ru/',\r\n\t\t// serverProxy = serverBase + 'Plugins/ForestReport/proxy',\r\n\t\tgmxProxy = '//maps.kosmosnimki.ru/ApiSave.ashx';\r\n\r\n// let _app = {},\r\n\t// loaderStatus = {},\r\n\t// _sessionKeys = {},\r\nlet str = self.location.origin || '',\r\n\t_protocol = str.substring(0, str.indexOf('/')),\r\n\tsyncParams = {},\r\n\tfetchOptions = {\r\n\t\t// method: 'post',\r\n\t\t// headers: {'Content-type': 'application/x-www-form-urlencoded'},\r\n\t\tmode: 'cors',\r\n\t\tredirect: 'follow',\r\n\t\tcredentials: 'include'\r\n\t};\r\n\r\nconst COMPARS = {WrapStyle: 'None', ftc: 'osm', srs: 3857};\r\n\r\nconst setSyncParams = (hash) => {\t// установка дополнительных параметров для серверных запросов\r\n\tsyncParams = hash;\r\n};\r\nconst getSyncParams = (stringFlag) => {\r\n\tvar res = syncParams;\r\n\tif (stringFlag) {\r\n\t\tvar arr = [];\r\n\t\tfor (var key in res) {\r\n\t\t\tarr.push(key + '=' + res[key]);\r\n\t\t}\r\n\t\tres = arr.join('&');\r\n\t}\r\n\treturn res;\r\n};\r\n\r\nconst parseURLParams = (str) => {\r\n\tlet sp = new URLSearchParams(str || location.search),\r\n\t\tout = {},\r\n\t\tarr = [];\r\n\tfor (let p of sp) {\r\n\t\tlet k = p[0], z = p[1];\r\n\t\tif (z) {\r\n\t\t\tif (!out[k]) {out[k] = [];}\r\n\t\t\tout[k].push(z);\r\n\t\t} else {\r\n\t\t\tarr.push(k);\r\n\t\t}\r\n\t}\r\n\treturn {main: arr, keys: out};\r\n};\r\nlet utils = {\r\n\textend: function (dest) {\r\n\t\tvar i, j, len, src;\r\n\r\n\t\tfor (j = 1, len = arguments.length; j < len; j++) {\r\n\t\t\tsrc = arguments[j];\r\n\t\t\tfor (i in src) {\r\n\t\t\t\tdest[i] = src[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dest;\r\n\t},\r\n\r\n\tmakeTileKeys: function(it, ptiles) {\r\n\t\tvar tklen = it.tilesOrder.length,\r\n\t\t\tarr = it.tiles,\r\n\t\t\ttiles = {},\r\n\t\t\tnewTiles = {};\r\n\r\n\t\twhile (arr.length) {\r\n\t\t\tvar t = arr.splice(0, tklen),\r\n\t\t\t\ttk = t.join('_'),\r\n\t\t\t\ttile = ptiles[tk];\r\n\t\t\tif (!tile || !tile.data) {\r\n\t\t\t\tif (!tile) {\r\n\t\t\t\t\ttiles[tk] = {\r\n\t\t\t\t\t\ttp: {z: t[0], x: t[1], y: t[2], v: t[3], s: t[4], d: t[5]}\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttiles[tk] = tile;\r\n\t\t\t\t}\r\n\t\t\t\tnewTiles[tk] = true;\r\n\t\t\t} else {\r\n\t\t\t\ttiles[tk] = tile;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {tiles: tiles, newTiles: newTiles};\r\n\t},\r\n\r\n\tgetZoomRange: function(info) {\r\n\t\tvar arr = info.properties.styles,\r\n\t\t\tout = [40, 0];\r\n\t\tfor (var i = 0, len = arr.length; i < len; i++) {\r\n\t\t\tvar st = arr[i];\r\n\t\t\tout[0] = Math.min(out[0], st.MinZoom);\r\n\t\t\tout[1] = Math.max(out[1], st.MaxZoom);\r\n\t\t}\r\n\t\tout[0] = out[0] === 40 ? 1 : out[0];\r\n\t\tout[1] = out[1] === 0 ? 22 : out[1];\r\n\t\treturn out;\r\n\t},\r\n\r\n\tchkProtocol: function(url) {\r\n\t\treturn url.substr(0, _protocol.length) === _protocol ? url : _protocol + url;\r\n\t},\r\n\tgetFormBody: function(par) {\r\n\t\treturn Object.keys(par).map(function(key) { return encodeURIComponent(key) + '=' + encodeURIComponent(par[key]); }).join('&');\r\n\t},\r\n\tchkResponse: function(resp, type) {\r\n\t\tif (resp.status < 200 || resp.status >= 300) {\t\t\t\t\t\t// error\r\n\t\t\treturn Promise.reject(resp);\r\n\t\t} else {\r\n\t\t\tvar contentType = resp.headers.get('Content-Type');\r\n\t\t\tif (type === 'bitmap') {\t\t\t\t\t\t\t\t\t\t\t\t// get blob\r\n\t\t\t\treturn resp.blob();\r\n\t\t\t} else if (contentType.indexOf('application/json') > -1) {\t\t\t\t// application/json; charset=utf-8\r\n\t\t\t\treturn resp.json();\r\n\t\t\t} else if (contentType.indexOf('text/javascript') > -1) {\t \t\t\t// text/javascript; charset=utf-8\r\n\t\t\t\treturn resp.text();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.text();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.formData();\r\n\t\t\t// } else if (contentType.indexOf('application/json') > -1) {\t \t\t// application/json; charset=utf-8\r\n\t\t\t\t// ret = resp.arrayBuffer();\r\n\t\t\t// } else {\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn resp.text();\r\n\t},\r\n\t// getJson: function(url, params, options) {\r\n\tgetJson: function(queue) {\r\n// log('getJson', _protocol, queue, Date.now())\r\n\t\tlet params = queue.params || {};\r\n\t\tif (queue.paramsArr) {\r\n\t\t\tqueue.paramsArr.forEach((it) => {\r\n\t\t\t\tparams = utils.extend(params, it);\r\n\t\t\t});\r\n\t\t}\r\n\t\tlet par = utils.extend({}, params, syncParams),\r\n\t\t\toptions = queue.options || {},\r\n\t\t\topt = utils.extend({\r\n\t\t\t\tmethod: 'post',\r\n\t\t\t\theaders: {'Content-type': 'application/x-www-form-urlencoded'}\r\n\t\t\t\t// mode: 'cors',\r\n\t\t\t\t// redirect: 'follow',\r\n\t\t\t\t// credentials: 'include'\r\n\t\t\t}, fetchOptions, options, {\r\n\t\t\t\tbody: utils.getFormBody(par)\r\n\t\t\t});\r\n\t\treturn fetch(utils.chkProtocol(queue.url), opt)\r\n\t\t.then(function(res) {\r\n\t\t\treturn utils.chkResponse(res, options.type);\r\n\t\t})\r\n\t\t.then(function(res) {\r\n\t\t\tvar out = {url: queue.url, queue: queue, load: true, res: res};\r\n\t\t\t// if (queue.send) {\r\n\t\t\t\t// handler.workerContext.postMessage(out);\r\n\t\t\t// } else {\r\n\t\t\t\treturn out;\r\n\t\t\t// }\r\n\t\t})\r\n\t\t.catch(function(err) {\r\n\t\t\treturn {url: queue.url, queue: queue, load: false, error: err.toString()};\r\n\t\t\t// handler.workerContext.postMessage(out);\r\n\t\t});\r\n    },\r\n    parseLayerProps: function(prop) {\r\n\t\t// let ph = utils.getTileAttributes(prop);\r\n\t\treturn utils.extend(\r\n\t\t\t{\r\n\t\t\t\tproperties: prop\r\n\t\t\t},\r\n\t\t\tutils.getTileAttributes(prop),\r\n\t\t\tutils.parseMetaProps(prop)\r\n\t\t);\r\n\t\t\r\n\t\t\r\n\t\t// return ph;\r\n    },\r\n\r\n    parseMetaProps: function(prop) {\r\n        var meta = prop.MetaProperties || {},\r\n            ph = {};\r\n        ph.dataSource = prop.dataSource || prop.LayerID;\r\n\t\tif ('parentLayer' in meta) {\t\t\t\t\t\t\t\t// изменить dataSource через MetaProperties\r\n\t\t\tph.dataSource = meta.parentLayer.Value || '';\r\n\t\t}\r\n\t\t[\r\n\t\t\t'srs',\t\t\t\t\t// проекция слоя\r\n\t\t\t'gmxProxy',\t\t\t\t// установка прокачивалки\r\n\t\t\t'filter',\t\t\t\t// фильтр слоя\r\n\t\t\t'isGeneralized',\t\t// флаг generalization\r\n\t\t\t'isFlatten',\t\t\t// флаг flatten\r\n\t\t\t'multiFilters',\t\t\t// проверка всех фильтров для обьектов слоя\r\n\t\t\t'showScreenTiles',\t\t// показывать границы экранных тайлов\r\n\t\t\t'dateBegin',\t\t\t// фильтр по дате начало периода\r\n\t\t\t'dateEnd',\t\t\t\t// фильтр по дате окончание периода\r\n\t\t\t'shiftX',\t\t\t\t// сдвиг всего слоя\r\n\t\t\t'shiftY',\t\t\t\t// сдвиг всего слоя\r\n\t\t\t'shiftXfield',\t\t\t// сдвиг растров объектов слоя\r\n\t\t\t'shiftYfield',\t\t\t// сдвиг растров объектов слоя\r\n\t\t\t'quicklookPlatform',\t// тип спутника\r\n\t\t\t'quicklookX1',\t\t\t// точки привязки снимка\r\n\t\t\t'quicklookY1',\t\t\t// точки привязки снимка\r\n\t\t\t'quicklookX2',\t\t\t// точки привязки снимка\r\n\t\t\t'quicklookY2',\t\t\t// точки привязки снимка\r\n\t\t\t'quicklookX3',\t\t\t// точки привязки снимка\r\n\t\t\t'quicklookY3',\t\t\t// точки привязки снимка\r\n\t\t\t'quicklookX4',\t\t\t// точки привязки снимка\r\n\t\t\t'quicklookY4'\t\t\t// точки привязки снимка\r\n\t\t].forEach((k) => {\r\n\t\t\tph[k] = k in meta ? meta[k].Value : '';\r\n\t\t});\r\n\t\tif (ph.gmxProxy.toLowerCase() === 'true') {    // проверка прокачивалки\r\n\t\t\tph.gmxProxy = gmxProxy;\r\n\t\t}\r\n\t\tif ('parentLayer' in meta) {  // фильтр слоя\t\t// todo удалить после изменений вов вьювере\r\n\t\t\tph.dataSource = meta.parentLayer.Value || prop.dataSource || '';\r\n\t\t}\r\n\r\n        return ph;\r\n    },\r\n\r\n    getTileAttributes: function(prop) {\r\n        var tileAttributeIndexes = {},\r\n            tileAttributeTypes = {};\r\n        if (prop.attributes) {\r\n            var attrs = prop.attributes,\r\n                attrTypes = prop.attrTypes || null;\r\n            if (prop.identityField) { tileAttributeIndexes[prop.identityField] = 0; }\r\n            for (var a = 0; a < attrs.length; a++) {\r\n                var key = attrs[a];\r\n                tileAttributeIndexes[key] = a + 1;\r\n                tileAttributeTypes[key] = attrTypes ? attrTypes[a] : 'string';\r\n            }\r\n        }\r\n        return {\r\n            tileAttributeTypes: tileAttributeTypes,\r\n            tileAttributeIndexes: tileAttributeIndexes\r\n        };\r\n    }\r\n};\r\n/*\r\nconst requestSessionKey = (serverHost, apiKey) => {\r\n\tlet keys = _sessionKeys;\r\n\tif (!(serverHost in keys)) {\r\n\t\tkeys[serverHost] = new Promise(function(resolve, reject) {\r\n\t\t\tif (apiKey) {\r\n\t\t\t\tutils.getJson({\r\n\t\t\t\t\turl: '//' + serverHost + '/ApiKey.ashx',\r\n\t\t\t\t\tparams: {WrapStyle: 'None', Key: apiKey}\r\n\t\t\t\t})\r\n\t\t\t\t\t.then(function(json) {\r\n\t\t\t\t\t\tlet res = json.res;\r\n\t\t\t\t\t\tif (res.Status === 'ok' && res.Result) {\r\n\t\t\t\t\t\t\tresolve(res.Result.Key !== 'null' ? '' : res.Result.Key);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treject(json);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(function() {\r\n\t\t\t\t\t\tresolve('');\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tresolve('');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn keys[serverHost];\r\n};\r\nlet _maps = {};\r\nconst getMapTree = (pars) => {\r\n\tpars = pars || {};\r\n\tlet hostName = pars.hostName || serverBase,\r\n\t\tid = pars.mapId;\r\n\treturn utils.getJson({\r\n\t\turl: '//' + hostName + '/Map/GetMapFolder',\r\n\t\t// options: {},\r\n\t\tparams: {\r\n\t\t\tsrs: 3857, \r\n\t\t\tskipTiles: 'All',\r\n\r\n\t\t\tmapId: id,\r\n\t\t\tfolderId: 'root',\r\n\t\t\tvisibleItemOnly: false\r\n\t\t}\r\n\t})\r\n\t\t.then(function(json) {\r\n\t\t\tlet out = parseTree(json.res);\r\n\t\t\t_maps[hostName] = _maps[hostName] || {};\r\n\t\t\t_maps[hostName][id] = out;\r\n\t\t\treturn parseTree(out);\r\n\t\t});\r\n};\r\nconst getReq = url => {\r\n\treturn fetch(url, {\r\n\t\t\tmethod: 'get',\r\n\t\t\tmode: 'cors',\r\n\t\t\tcredentials: 'include'\r\n\t\t// headers: {'Accept': 'application/json'},\r\n\t\t// body: JSON.stringify(params)\t// TODO: сервер почему то не хочет работать так https://googlechrome.github.io/samples/fetch-api/fetch-post.html\r\n\t\t})\r\n\t\t.then(res => res.json())\r\n\t\t.catch(err => console.warn(err));\r\n};\r\n\r\n// const getLayerItems = (params) => {\r\n\t// params = params || {};\r\n\r\n\t// let url = `${serverBase}VectorLayer/Search.ashx`;\r\n\t// url += '?layer=' + params.layerID;\r\n\t// if (params.id) { '&query=gmx_id=' + params.id; }\r\n\r\n\t// url += '&out_cs=EPSG:4326';\r\n\t// url += '&geometry=true';\r\n\t// return getReq(url);\r\n// };\r\n// const getReportsCount = () => {\r\n\t// return getReq(serverProxy + '?path=/rest/v1/get-current-user-info');\r\n// };\r\n\r\nlet dataSources = {},\r\n\tloaderStatus1 = {};\r\n\r\nconst addDataSource = (pars) => {\r\n\tpars = pars || {};\r\n\r\n\tlet id = pars.id;\r\n\tif (id) {\r\n\t\tlet hostName = pars.hostName;\r\n\t\t\r\n\t} else {\r\n\t\tconsole.warn('Warning: Specify layer \\'id\\' and \\'hostName\\`', pars);\r\n\t}\r\nconsole.log('addDataSource:', pars);\r\n\treturn;\r\n};\r\n\r\nconst removeDataSource = (pars) => {\r\n\tpars = pars || {};\r\n\r\n\tlet id = pars.id;\r\n\tif (id) {\r\n\t\tlet hostName = pars.hostName;\r\n\t\t\r\n\t} else {\r\n\t\tconsole.warn('Warning: Specify layer \\'id\\' and \\'hostName\\`', pars);\r\n\t}\r\nconsole.log('removeDataSource:', pars);\r\n\t//Requests.removeDataSource({id: message.layerID, hostName: message.hostName}).then((json) => {\r\n\treturn;\r\n};\r\n*/\r\nlet _maps = {};\r\nconst getMapTree = (pars) => {\r\n\tpars = pars || {};\r\n\tlet hostName = pars.hostName || serverBase,\r\n\t\tid = pars.mapId;\r\n\treturn utils.getJson({\r\n\t\turl: '//' + hostName + '/Map/GetMapFolder',\r\n\t\t// options: {},\r\n\t\tparams: {\r\n\t\t\tsrs: 3857, \r\n\t\t\tskipTiles: 'All',\r\n\r\n\t\t\tmapId: id,\r\n\t\t\tfolderId: 'root',\r\n\t\t\tvisibleItemOnly: false\r\n\t\t}\r\n\t})\r\n\t\t.then(function(json) {\r\n\t\t\tlet out = parseTree(json.res);\r\n\t\t\t_maps[hostName] = _maps[hostName] || {};\r\n\t\t\t_maps[hostName][id] = out;\r\n\t\t\treturn parseTree(out);\r\n\t\t});\r\n};\r\n\r\nconst _iterateNodeChilds = (node, level, out) => {\r\n\tlevel = level || 0;\r\n\tout = out || {\r\n\t\tlayers: []\r\n\t};\r\n\t\r\n\tif (node) {\r\n\t\tlet type = node.type,\r\n\t\t\tcontent = node.content,\r\n\t\t\tprops = content.properties;\r\n\t\tif (type === 'layer') {\r\n\t\t\tlet ph = utils.parseLayerProps(props);\r\n\t\t\tph.level = level;\r\n\t\t\tif (content.geometry) { ph.geometry = content.geometry; }\r\n\t\t\tout.layers.push(ph);\r\n\t\t} else if (type === 'group') {\r\n\t\t\tlet childs = content.children || [];\r\n\t\t\tout.layers.push({ level: level, group: true, childsLen: childs.length, properties: props });\r\n\t\t\tchilds.map((it) => {\r\n\t\t\t\t_iterateNodeChilds(it, level + 1, out);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t} else {\r\n\t\treturn out;\r\n\t}\r\n\treturn out;\r\n};\r\n\r\nconst parseTree = (json) => {\r\n\tlet out = {};\r\n\tif (json.Status === 'error') {\r\n\t\tout = json;\r\n\t} else if (json.Result && json.Result.content) {\r\n\t\tout = _iterateNodeChilds(json.Result);\r\n\t\tout.mapAttr = out.layers.shift();\r\n\t}\r\n// console.log('______json_out_______', out, json)\r\n\treturn out;\r\n};\r\n\r\n\r\nconst chkSignal = (signalName, signals, opt) => {\r\n\topt = opt || {};\r\n\tlet sObj = signals[signalName];\r\n\t\r\n\tif (sObj) { sObj.abort(); }\r\n\tsObj = signals[signalName] = new AbortController();\r\n\tsObj.signal.addEventListener('abort', (ev) => console.log('Отмена fetch:', ev));\r\n\topt.signal = sObj.signal;\r\n\tsignals[signalName] = sObj;\r\n\treturn opt;\r\n};\r\n\r\nexport default {\r\n\tchkSignal,\r\n\tCOMPARS,\r\n\tsetSyncParams,\r\n\tgetSyncParams,\r\n\tparseURLParams,\r\n\tgetMapTree,\r\n\tgetJson: utils.getJson\r\n\t// addDataSource,\r\n\t// removeDataSource,\r\n\t// getReportsCount,\r\n\t// getLayerItems\r\n};","import Requests from './Requests';\r\n\r\nconst HOST = 'maps.kosmosnimki.ru',\r\n        // this.tileSenderPrefix = L.gmxUtil.protocol + '//' + hostName + '/' +\r\n            // 'TileSender.ashx?WrapStyle=None' +\r\n            // '&key=' + encodeURIComponent(sessionKey);\r\n\r\n    WORLDWIDTHFULL = 40075016.685578496,\r\n\tW = WORLDWIDTHFULL / 2,\r\n\tWORLDBBOX = [[-W, -W, W, W]],\r\n    SCRIPT = '/Layer/CheckVersion.ashx';\r\n\r\nlet hosts = {},\r\n    zoom = 3,\r\n    bbox = null,\r\n\t// dataManagersLinks = {},\r\n    // hostBusy = {},\r\n    // needReq = {}\r\n    delay = 60000,\r\n\tintervalID = null,\r\n    timeoutID = null;\r\n\r\nconst load = (pars) => {\r\n\tpars = pars || {};\r\nconsole.log('load:', pars);\r\n\tif (!pars.signals) { pars.signals = {}; }\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet arr = [];\r\n\t\tlet pb = pars.tiles;\r\n\t\tfor (let i = 0, len = pb.length; i < len; i+=6) {\r\n\t\t\tarr.push(Requests.getJson({\r\n\t\t\t\turl: '//' + pars.hostName + '/TileSender.ashx',\r\n\t\t\t\toptions: Requests.chkSignal('TileLoader', pars.signals, {\r\n\t\t\t\t\tmode: 'cors',\r\n\t\t\t\t\tcredentials: 'include'\r\n\t\t\t\t}),\r\n\t\t\t\tparamsArr: [Requests.COMPARS, {\r\n\t\t\t\t\tz: pb[i], x: pb[i + 1], y: pb[i + 2], v: pb[i + 3], Level: pb[i + 4], Span: pb[i + 5],\r\n\t\t\t\t\tLayerName: pars.id,\r\n\t\t\t\t\t// bboxes: JSON.stringify(bbox || [WORLDBBOX]),\r\n\t\t\t\t\t// generalizedTiles: false,\r\n\t\t\t\t\t// zoom: zoom\r\n\t\t\t\t}]\r\n\t\t\t}).then(json => {\r\n\t\t\t\tdelete pars.signals.TileLoader;\r\n\t\t\t\treturn json;\r\n\t\t\t})\r\n\t\t\t.catch(err => {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t\t// resolve('');\r\n\t\t\t})\r\n\t\t\t);\r\n\r\n\t\t}\r\n\t});\r\n};\r\n\r\nexport default {\r\n\tload\r\n};","import Requests from './Requests';\r\nimport TilesLoader from './TilesLoader';\r\n\r\nconst HOST = 'maps.kosmosnimki.ru',\r\n    WORLDWIDTHFULL = 40075016.685578496,\r\n\tW = WORLDWIDTHFULL / 2,\r\n\tWORLDBBOX = [[-W, -W, W, W]],\r\n    SCRIPT = '/Layer/CheckVersion.ashx';\r\n\r\nlet hosts = {},\r\n    zoom = 3,\r\n    bbox = null,\r\n\t// dataManagersLinks = {},\r\n    // hostBusy = {},\r\n    // needReq = {}\r\n    delay = 60000,\r\n\tintervalID = null,\r\n    timeoutID = null;\r\n\r\nconst utils = {\r\n    now: function() {\r\n\t\tif (timeoutID) { clearTimeout(timeoutID); }\r\n\t\ttimeoutID = setTimeout(chkVersion, 0);\r\n    },\r\n\r\n    stop: function() {\r\n\t\tconsole.log('stop:', intervalID, delay);\r\n        if (intervalID) { clearInterval(intervalID); }\r\n        intervalID = null;\r\n    },\r\n\r\n    start: function(msec) {\r\n\t\tconsole.log('start:', intervalID, msec);\r\n        if (msec) { delay = msec; }\r\n        utils.stop();\r\n        intervalID = setInterval(chkVersion, delay);\r\n    }\r\n};\r\n\r\n// const COMPARS = {WrapStyle: 'None', ftc: 'osm', srs: 3857};\r\n\r\n// const chkSignal = (signalName, signals, opt) => {\r\n\t// opt = opt || {};\r\n\t// let sObj = signals[signalName];\r\n\t\r\n\t// if (sObj) { sObj.abort(); }\r\n\t// sObj = signals[signalName] = new AbortController();\r\n\t// sObj.signal.addEventListener('abort', (ev) => console.log('Отмена fetch:', ev));\r\n\t// opt.signal = sObj.signal;\r\n\t// signals[signalName] = sObj;\r\n\t// return opt;\r\n// };\r\n\r\nconst chkHost = (hostName) => {\r\n\tconsole.log('chkVersion:', hostName, hosts);\r\n\tlet hostLayers = hosts[hostName],\r\n\t\tids = hostLayers.ids,\r\n\t\tarr = [];\r\n\r\n\tfor (let name in ids) {\r\n\t\tlet pt = ids[name],\r\n\t\t\tpars = { Name: name, Version: 'v' in pt ? pt.v : -1 };\r\n\t\tif (pt.dateBegin) {\r\n\t\t\tpars.dateBegin = pt.dateBegin;\r\n\t\t}\r\n\t\tif (pt.dateEnd) {\r\n\t\t\tpars.dateEnd = pt.dateEnd;\r\n\t\t}\r\n\t\tarr.push(pars);\r\n\t}\r\n\r\n\treturn Requests.getJson({\r\n\t\turl: '//' + hostName + SCRIPT,\r\n\t\toptions: Requests.chkSignal('chkVersion', hostLayers.signals),\r\n\t\tparamsArr: [Requests.COMPARS, {\r\n\t\t\tlayers: JSON.stringify(arr),\r\n\t\t\tbboxes: JSON.stringify(bbox || [WORLDBBOX]),\r\n\t\t\tgeneralizedTiles: false,\r\n\t\t\tzoom: zoom\r\n\t\t}]\r\n\t}).then(json => {\r\n\t\tdelete hostLayers.signals.chkVersion;\r\n\t\treturn json;\r\n\t})\r\n\t.catch(err => {\r\n\t\tconsole.error(err);\r\n\t\t// resolve('');\r\n\t});\r\n};\r\nconst chkVersion = () => {\r\n\t// console.log('chkVersion:', id, hosts);\r\n\tfor (let key in hosts) {\r\n\t\tchkHost(key).then(json => {\r\n\t\t\tif (json.error) {\r\n\t\t\t\tconsole.warn('chkVersion:', json.error);\r\n\t\t\t} else {\r\n\t\t\t\tlet hostLayers = hosts[key],\r\n\t\t\t\t\tids = hostLayers.ids,\r\n\t\t\t\t\tres = json.res;\r\n\t\t\t\tif (res.Status === 'ok' && res.Result) {\r\n\t\t\t\t\tres.Result.forEach(it => {\r\n\t\t\t\t\t\tlet pt = ids[it.name],\r\n\t\t\t\t\t\t\tprops = it.properties;\r\n\t\t\t\t\t\tif (props) {\r\n\t\t\t\t\t\t\tpt.v = props.LayerVersion;\r\n\t\t\t\t\t\t\tpt.properties = props;\r\n\t\t\t\t\t\t\tpt.geometry = it.geometry;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tpt.tiles = it.tiles;\r\n\t\t\t\t\t\tpt.tilesOrder = it.tilesOrder;\r\n\t\t\t\t\t\tpt.tilePromises = TilesLoader.load(pt);\r\n\t\t\t\t// console.log('chkVersion ___:', id, pt, v);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// resolve(res.Result.Key !== 'null' ? '' : res.Result.Key);\r\n\t\t\t\t// } else {\r\n\t\t\t\t\t// reject(json);\r\n\t\t\t\t\tconsole.log('chkVersion key:', key, hosts);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n\r\nconst addSource = (pars) => {\r\n\tpars = pars || {};\r\n\r\n\tlet id = pars.id;\r\n\t\r\n\tif ('zoom' in pars) { zoom = pars.zoom; }\r\n\tif ('bbox' in pars) { bbox = pars.bbox; }\r\n\t\t\r\n\tif (id) {\r\n\t\tlet hostName = pars.hostName || HOST;\r\n\t\tif (!hosts[hostName]) {\r\n\t\t\thosts[hostName] = {ids: {}, signals: {}};\r\n\t\t\tif (pars.apiKey) {\r\n\t\t\t\thosts[hostName].apiKeyPromise = Requests.getJson({\r\n\t\t\t\t\turl: '//' + hostName + '/ApiKey.ashx',\r\n\t\t\t\t\tparamsArr: [Requests.COMPARS, {\r\n\t\t\t\t\t\tKey: pars.apiKey\r\n\t\t\t\t\t}]\r\n\t\t\t\t}).then((json) => {\r\n\t\t\t\t\t// console.log('/ApiKey.ashx', json);\r\n\t\t\t\t\tlet res = json.res;\r\n\t\t\t\t\tif (res.Status === 'ok' && res.Result) {\r\n\t\t\t\t\t\thosts[hostName].Key = res.Result.Key;\r\n\t\t\t\t\t\treturn hosts[hostName].Key;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\thosts[hostName].ids[id] = pars;\r\n        if (!intervalID) { utils.start(); }\r\n\t\tutils.now();\r\n\t} else {\r\n\t\tconsole.warn('Warning: Specify layer `id` and `hostName`', pars);\r\n\t}\r\n// console.log('addSource:', pars);\r\n\treturn;\r\n};\r\n\r\nconst removeSource = (pars) => {\r\n\tpars = pars || {};\r\n\r\n\tlet id = pars.id;\r\n\tif (id) {\r\n\t\tlet hostName = pars.hostName || HOST;\r\n\t\tif (hosts[hostName]) {\r\n\t\t\tdelete hosts[hostName].ids[id];\r\n\t\t\tif (Object.keys(hosts[hostName].ids).length === 0) { delete hosts[hostName]; }\r\n\t\t\tif (Object.keys(hosts).length === 0) { utils.stop(); }\r\n\t\t}\r\n\t} else {\r\n\t\tconsole.warn('Warning: Specify layer id and hostName', pars);\r\n\t}\r\n// console.log('removeSource:', pars);\r\n\t//Requests.removeDataSource({id: message.layerID, hostName: message.hostName}).then((json) => {\r\n\treturn;\r\n};\r\n\r\nconst moveend = (pars) => {\r\n\tpars = pars || {};\r\nconsole.log('moveend:', pars);\r\n\t\r\n\tif ('zoom' in pars) { zoom = pars.zoom; }\r\n\tif ('bbox' in pars) { bbox = pars.bbox; }\r\n\t\t\r\n\tutils.now();\r\n\treturn;\r\n};\r\n\r\nexport default {\r\n\tmoveend,\r\n\tremoveSource,\r\n\taddSource\r\n};","import Requests from './Requests.js';\r\nimport DataVersion from './DataSourceVersion';\r\n\r\nvar _self = self;\r\n(_self.on || _self.addEventListener).call(_self, 'message', e => {\r\n    const message = e.data || e;\r\n// console.log('message ', e);\r\n    switch (message.cmd) {\r\n\t\tcase 'getLayerItems':\r\n\t\t\tRequests.getLayerItems({layerID: message.layerID}).then((json) => {\r\n\t\t\t\tmessage.out = json;\r\n\t\t\t\tlet pt = {};\r\n\t\t\t\tjson.Result.fields.forEach((name, i) => { pt[name] = i; });\r\n\t\t\t\tjson.Result.fieldKeys = pt;\r\n\t\t\t\t_self.postMessage(message);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tcase 'getMap':\r\n\t\t\tRequests.getMapTree({mapId: message.mapID, hostName: message.hostName, search: message.search}).then((json) => {\r\n\t\t\t\tmessage.out = json;\r\n\t\t\t\t_self.postMessage(message);\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tcase 'setSyncParams':\r\n\t\t\tRequests.setSyncParams(message.syncParams);\r\n\t\t\tbreak;\r\n\t\tcase 'getSyncParams':\r\n\t\t\tmessage.syncParams = Requests.getSyncParams(message.stringFlag);\r\n\t\t\t_self.postMessage(message);\r\n\t\t\tbreak;\r\n\t\tcase 'addDataSource':\r\n\t\t\tDataVersion.addSource(message);\r\n\t\t\t// .then((json) => {\r\n\t\t\t\t// message.out = json;\r\n\t\t\t\t// _self.postMessage(message);\r\n\t\t\t// });\r\n\t\t\tbreak;\r\n\t\tcase 'removeDataSource':\r\n\t\t\tDataVersion.removeSource({id: message.id, hostName: message.hostName});\r\n\t\t\tbreak;\r\n\t\tcase 'moveend':\r\n\t\t\tDataVersion.moveend(message);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tconsole.warn('Неизвестная команда:', message.cmd);\r\n\t\t\tbreak;\r\n\t}\r\n});\r\n\r\n"],"names":["_self","self","window","serverBase","gmxProxy","str","location","origin","_protocol","substring","indexOf","syncParams","fetchOptions","mode","redirect","credentials","COMPARS","WrapStyle","ftc","srs","setSyncParams","hash","getSyncParams","stringFlag","res","arr","key","push","join","parseURLParams","sp","URLSearchParams","search","out","p","k","z","main","keys","utils","extend","dest","i","j","len","src","arguments","length","makeTileKeys","it","ptiles","tklen","tilesOrder","tiles","newTiles","t","splice","tk","tile","data","tp","x","y","v","s","d","getZoomRange","info","properties","styles","st","Math","min","MinZoom","max","MaxZoom","chkProtocol","url","substr","getFormBody","par","Object","map","encodeURIComponent","chkResponse","resp","type","status","Promise","reject","contentType","headers","get","blob","json","text","getJson","queue","params","paramsArr","forEach","options","opt","method","body","fetch","then","load","catch","err","error","toString","parseLayerProps","prop","getTileAttributes","parseMetaProps","meta","MetaProperties","ph","dataSource","LayerID","parentLayer","Value","toLowerCase","tileAttributeIndexes","tileAttributeTypes","attributes","attrs","attrTypes","identityField","a","_maps","getMapTree","pars","hostName","id","mapId","skipTiles","folderId","visibleItemOnly","parseTree","_iterateNodeChilds","node","level","layers","content","props","geometry","childs","children","group","childsLen","Status","Result","mapAttr","shift","chkSignal","signalName","signals","sObj","abort","AbortController","signal","addEventListener","ev","console","log","resolve","pb","Requests","Level","Span","LayerName","TileLoader","HOST","WORLDWIDTHFULL","W","WORLDBBOX","SCRIPT","hosts","zoom","bbox","delay","intervalID","timeoutID","now","clearTimeout","setTimeout","chkVersion","stop","clearInterval","start","msec","setInterval","chkHost","hostLayers","ids","name","pt","Name","Version","dateBegin","dateEnd","JSON","stringify","bboxes","generalizedTiles","warn","LayerVersion","tilePromises","TilesLoader","addSource","apiKey","apiKeyPromise","Key","removeSource","moveend","on","call","e","message","cmd","getLayerItems","layerID","fields","fieldKeys","postMessage","mapID","DataVersion"],"mappings":"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"}